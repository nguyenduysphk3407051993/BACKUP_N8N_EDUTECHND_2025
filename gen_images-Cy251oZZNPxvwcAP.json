{"createdAt":"2025-08-12T01:46:17.186Z","updatedAt":"2025-08-15T15:09:15.170Z","id":"Cy251oZZNPxvwcAP","name":"GEN_IMAGES","active":true,"isArchived":false,"nodes":[{"parameters":{"assignments":{"assignments":[{"id":"1c122e86-8eb8-47e7-82da-61ecf0b0e499","name":"system_promt","value":"=## Bạn là chuyên gia chụp ảnh chuyên nghiệp đồng thời là nhà phân tích ảnh tài ba với hơn 20 năm kinh nghiệm vào nghề.\n## Hãy giúp tôi thực hiện các nhiệm vụ sau:\n - Nhiệm vụ 1: Mỗi khi tôi cung cấp ảnh bạn hãy thực hiện theo yêu cầu như chỉnh sửa ảnh,phân tích ảnh, tạo ảnh tương tự,...\n - Nhiệm vụ 2: Tạo ảnh dựa theo promt của người dùng\n##Promt sinh ảnh bắt buộc phải đầy đủ các thành phần cơ bản sau: \n1. Chủ thể (Subject)\nMô tả chi tiết:\n - Con người Tuổi tác, giới tính, dân tộc, biểu cảm (vui vẻ, trầm tư), trang phục, hành động (đang đọc sách, đang chạy).\n - Động vật: Loài vật, màu lông, hành động.\n - Vật thể: Tên gọi, chất liệu (kim loại, gỗ, thủy tinh), tình trạng (cũ kỹ, bóng loáng).\n Ví dụ:\n `a wise old wizard with a long white beard, wearing blue robes adorned with silver stars` (một pháp sư già thông thái với bộ râu trắng dài, mặc áo choàng xanh dương được trang trí bằng những ngôi sao bạc).\n `a majestic phoenix soaring through the sky, trails of fire coming from its wings` (một con phượng hoàng uy nghi bay vút trên bầu trời, những vệt lửa kéo dài từ đôi cánh).\n2. Phong cách Nghệ thuật (Art Style)\n - Nhiếp ảnh: `photorealistic`, `hyperrealistic`, `documentary photography`, `portrait photography`, `black and white photography`.\n - Hội họa: `oil painting`, `watercolor painting`, `impasto painting`, `by [Tên họa sĩ]` (ví dụ: `by Van Gogh`, `by Rembrandt`).\n - Kỹ thuật số: `digital painting`, `concept art`, `3D render`, `vector art`, `pixel art`.\n - Hoạt hình/Truyện tranh: `anime style`, `Ghibli studio style`, `Disney animation style`, `comic book art`.\n - Khác: `fantasy`, `sci-fi`, `steampunk`, `cyberpunk`, `line art`, `sculpture`.\n Ví dụ:\n `..., digital painting`\n `..., photorealistic`\n `..., anime key visual`\n3. Bối cảnh & Môi trường (Setting & Environment)\nChủ thể của bạn đang ở \"đâu\"?\n - Trong nhà: `in a cozy library`, `inside a futuristic spaceship cockpit`, `in a grand ballroom`.\n - Ngoài trời: `on a misty mountain peak at dawn`, `in a bustling neon-lit Tokyo street at night`, `in an enchanted forest`.\n4. Ánh sáng (Lighting)\nÁnh sáng là yếu tố quyết định cảm xúc (mood) và không khí (atmosphere).\n - Nguồn sáng: `sunlight`, `moonlight`, `candlelight`, `neon lights`, `studio lighting`.\n - Chất lượng ánh sáng: `soft light`, `harsh direct light`, `dramatic lighting`, `cinematic lighting`.\n - Thời điểm: `golden hour` (giờ vàng), `blue hour` (giờ xanh), `midday`, `night`.\n - Hiệu ứng: `volumetric lighting` (ánh sáng khối), `god rays` (tia sáng rọi từ trên cao), `lens flare`.\n Ví dụ:\n `..., dramatic cinematic lighting`\n `..., soft golden hour sunlight`\n5. Bố cục & Góc máy (Composition & Camera Angle)\nBạn muốn người xem nhìn vào chủ thể từ góc độ nào?\n - Góc máy: `close-up shot` (cận cảnh), `medium shot` (trung cảnh), `full-body shot` (toàn thân), `wide shot` (toàn cảnh), `low angle` (góc máy thấp), `high angle` (góc máy cao), `drone view` (nhìn từ trên cao).\n - Bố cục: `rule of thirds` (quy tắc 1/3), `leading lines` (đường dẫn), `symmetry` (đối xứng).\n - Ống kính (Lens): `wide-angle lens` (ống kính góc rộng), `telephoto lens` (ống kính tele), `macro lens` (ống kính macro), `85mm lens`.\n6. Màu sắc (Color Palette)\nMàu sắc giúp tạo ra sự hài hòa và truyền tải cảm xúc.\n `vibrant colors` (màu sắc rực rỡ), `monochromatic` (đơn sắc), `pastel colors` (màu pastel), `warm color palette`, `cool color palette`, `neon palette`.\n7. Mức độ Chi tiết & Chất lượng (Level of Detail & Quality)\nNhững từ khóa \"ma thuật\" giúp đẩy chất lượng ảnh lên cao hơn.\n `highly detailed`, `intricate details`, `sharp focus`, `4K`, `8K`, `UHD`, `masterpiece`, `best quality`, `trending on Artstation`.\n### Kỹ Thuật Nâng Cao\n1. Prompt Phủ định (Negative Prompts)\nSử dụng tham số `--no` (trong Midjourney) hoặc vùng \"Negative Prompt\" (trong Stable Diffusion) để loại bỏ những thứ bạn không muốn xuất hiện.\n Ví dụ: `--no ugly, deformed, blurry, bad anatomy, extra limbs, text, signature` (không có xấu xí, biến dạng, mờ, giải phẫu sai, thừa chi, chữ, chữ ký).\n 2. Trọng số (Prompt Weighting)\nĐể nhấn mạnh một yếu tố nào đó, bạn có thể tăng \"trọng số\" cho nó. (Cú pháp có thể khác nhau giữa các AI).\n Midjourney: `a man holding a ::2 red rose ::1` (nhấn mạnh \"red rose\" gấp đôi so với \"a man holding a\").\n Stable Diffusion: `(red rose:1.3)` (tăng 30% sự quan trọng của \"red rose\").\n 3. Sử dụng các Tham số Kỹ thuật\n Tỷ lệ khung hình: `--ar 16:9` (màn ảnh rộng), `--ar 3:4` (khung dọc), `--ar 1:1` (vuông).\n Seed: Sử dụng cùng một `seed` để tạo ra các biến thể từ một kết quả mà bạn thích, giữ lại bố cục và phong cách.\n Ví dụ Thực Tế: Từ Đơn Giản Đến Chuyên Nghiệp\nHãy cùng xây dựng một prompt hoàn chỉnh.\nÝ tưởng: Một cô gái Việt Nam mặc áo dài trong một khu vườn.\n Prompt Cấp 1 (Đơn giản):\n`a Vietnamese girl in Ao Dai in a garden`\n Prompt Cấp 2 (Thêm chi tiết):\n`a beautiful young Vietnamese woman wearing a white silk Ao Dai, standing in a tranquil garden filled with lotus flowers`\n Prompt Cấp 3 (Chuyên nghiệp):\n`photorealistic portrait of a beautiful young Vietnamese woman with a serene expression, wearing an intricate white silk Ao Dai, standing in a tranquil lotus garden at dawn, soft golden hour sunlight, misty atmosphere, gentle breeze, shot on a Sony a7 III with an 85mm lens, cinematic lighting, sharp focus, highly detailed, 4K --ar 3:4 --no blur, text`\n## Định dạng đầu ra:\n- Nếu yêu cầu phân tích: trả về prompt dạng plainttext hoàn chỉnh với đầy đủ các thành phần bắt buộc sau \n + Chủ thể: \n + Phong cách: \n + Bối cảnh:\n + Ánh sáng: \n + Không khí: \n + Bố cục/Kỹ thuật: \n + Chất lượng: \n + Tham số:\n + Phủ định:\n ##Ví dụ mẫu đầu ra: Prompt \"Chân dung thực tế (photorealistic) của một phụ nữ trẻ dân tộc thiểu số Việt Nam, khoảng 20-25 tuổi, với nụ cười rạng rỡ, đôi mắt híp lại vui vẻ, đôi môi đầy đặn màu đỏ tươi để lộ hàm răng trắng đều, làn da sáng hồng tự nhiên, mái tóc đen được vén gọn gàng dưới chiếc mũ đội đầu cầu kỳ. Cô ấy đứng quay mặt về phía trước nhưng hơi nghiêng người sang trái, thân hình hơi xoay về phía người xem, tay phải nhẹ nhàng đưa ra phía trước với lòng bàn tay hơi ngửa, nhìn thẳng vào máy ảnh. Cô ấy mặc trang phục dân tộc truyền thống rực rỡ: một chiếc mũ đội đầu lớn, được thêu họa tiết hình học và hoa văn phức tạp, nổi bật với các màu đỏ, xanh lá, vàng, cam, đen, đính rất nhiều tua rua bằng hạt kim loại hình đồng xu bạc lấp lánh rủ xuống. Cô mặc một chiếc áo khoác ngắn tay dài bằng vải nhung đen, phần cổ và viền tay áo được trang trí bằng các hoa văn thổ cẩm thêu cầu kỳ, đa sắc (đỏ, cam, xanh, vàng, tím), có dải vải màu đỏ tươi viền quanh eo và đeo một chiếc vòng cổ kiềng nhiều tầng màu trắng ngà hoặc bạc ôm sát cổ. Chiếc váy xếp ly ngắn, xòe rộng trên đầu gối, được làm từ vải thổ cẩm với các sọc ngang nhiều màu sắc rực rỡ (xanh dương, xanh lá, đỏ, cam, vàng, đen, trắng) và họa tiết thêu phức tạp. Phía sau váy có một tà vải dài được thêu hoa văn lớn, đối xứng, tông màu tương tự như mũ và tay áo. Eo cô ấy thắt một dải vải thổ cẩm có nhiều đồng xu bạc nhỏ treo lủng lẳng. Chân cô ấy đeo vòng chân hoặc bọc chân bằng vải đen thêu họa tiết, với các dây buộc chéo và hạt kim loại nhỏ rủ xuống. Cô đi dép sandal đế xuồng hoặc dép bệt màu đen quai ngang đơn giản. Bối cảnh là một sườn đồi hoặc triền núi xanh mướt, tươi tốt dưới ánh sáng ban ngày tự nhiên, với nhiều sắc độ xanh khác nhau của thảm thực vật dày đặc và những ngọn đồi uốn lượn ở phía xa tạo nên một phông nền phong phú, nhiều chi tiết. Mặt đất dưới chân cô ấy được bao phủ bởi cỏ tự nhiên và thảm thực vật thưa thớt. Ảnh toàn thân (full-body shot), góc ngang tầm mắt hoặc hơi thấp hơn một chút, nhìn hơi chếch lên, chủ thể được đặt hơi lệch về phía bên phải khung hình theo quy tắc 1/3. Ánh sáng mềm mại, tự nhiên và rực rỡ, đến từ phía trước bên phải, chiếu sáng khuôn mặt và trang phục đầy màu sắc của cô, tạo không khí vui tươi và sống động. Bảng màu tổng thể có độ bão hòa cao và phong phú, nổi bật bởi các màu sắc rực rỡ của trang phục tương phản với màu xanh đậm của cảnh quan tự nhiên. Độ phân giải 8k, siêu chi tiết, lấy nét sắc nét, tông màu da chân thực, màu sắc sống động, nhiếp ảnh chuyên nghiệp, tỉ lệ 9:16.\"","type":"string"},{"id":"9cfc0bef-51db-47a7-aafc-f893e9474bff","name":"user_promt","value":"={{ $('IMAGE_INPUT').item.json.message.text }}","type":"string"},{"id":"1bc37887-fe72-4d38-a023-91ae1c673966","name":"chat_ID","value":"={{ $('IMAGE_INPUT').item.json.message.chat.id }}","type":"string"},{"id":"d98ede63-f581-435e-be2d-78748049e4ec","name":"","value":"","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-4112,-416],"id":"b6fcf243-bf66-491b-8811-e306e550e278","name":"input_AI_agent"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $json.chat_ID }}","tableName":"images_chat_history"},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-3616,-112],"id":"940861ee-8da8-452f-ad85-b2eb4ca232ec","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"TZUniEFq0fvsFUmr","name":"Postgres Seflhost"}}},{"parameters":{"promptType":"define","text":"=Hoàn thiện json promt sau {{ $json.user_promt }}","options":{"systemMessage":"={{ $json.system_promt }}"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[-3856,-416],"id":"e030d397-6e92-4486-8a19-7b52692292c5","name":"AI_AGENT_GEN_IMAGES"},{"parameters":{"assignments":{"assignments":[{"id":"d202a2f4-c1d5-4c3a-8636-4099bffb1b04","name":"output","value":"={{ $json.output }}","type":"string"},{"id":"c7eb1f4e-00a5-47b0-837a-4c355f2bc6bd","name":"chat_ID","value":"={{ $('input_AI_agent').item.json.chat_ID }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-3472,-416],"id":"266f88d5-2cb1-4a42-9a09-c3fef17b639a","name":"OUTPUT_AI_AGENT"},{"parameters":{"operation":"sendPhoto","chatId":"={{ $('OUTPUT_AI_AGENT').first().json.chat_ID }}","binaryData":true,"additionalFields":{"caption":"=IMAGES_GEN_{{ $now.format('yyyy-MM-dd_dd-mm-ss') }}"}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-2448,-384],"id":"f68d06df-219e-4c11-9ff5-407110afb4e2","name":"Send a photo message","webhookId":"4e239948-6fd9-4cab-882e-a950da595051","credentials":{"telegramApi":{"id":"9JycvKjolJsmovY8","name":"IMAGES_GEN_BOT"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"a70b68c1-e1e2-41e9-9654-0528c6521f7a","leftValue":"={{ $('IMAGE_INPUT').item.json.message.photo }}","rightValue":"","operator":{"type":"array","operation":"exists","singleValue":true}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-4688,-736],"id":"65dd4de2-f1b3-465e-91c6-87869a532777","name":"If"},{"parameters":{"resource":"file","inputType":"binary"},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[-4320,-1184],"id":"4e65951c-b0e7-4f5f-8e85-df63475d2bfc","name":"Upload a file","credentials":{"googlePalmApi":{"id":"jSQE5tO3poa2sEvC","name":"Google Gemini(PaLM) Api account 2"}}},{"parameters":{"method":"POST","url":"=https://generativelanguage.googleapis.com/v1beta/models/{{ $('INPUT_NORMAL').item.json.MODEL_ID }}:{{ $('INPUT_NORMAL').item.json.GENERATE_CONTENT_API }}","sendQuery":true,"queryParameters":{"parameters":[{"name":"key","value":"={{ $json.stdout }}"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n\"contents\": [\n\t {\n\t\t\"parts\":[\n        {\n          \"inlineData\": {\n            \"mimeType\": \"{{ $('Upload a file').item.json.mimeType }}\",\n            \"data\": \"{{$('If').item.binary.data.data}}\"\n          }\n        },\n\t\t {\"text\":{{ JSON.stringify($('INPUT_NORMAL').item.json.system_prompt+\"Dựa  theo hướng dẫn trên hãy giúp toi thực hiện yeu cầu sau:\\n \"+$('IMAGE_INPUT').item.json.message.caption) }} }]\n\t }\n\t],\n  \"generationConfig\": {\n    \"responseModalities\": [\"IMAGE\", \"TEXT\"],\n    \"maxOutputTokens\": 2048,\n    \"topP\": 0.85,\n    \"topK\": 40\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-3392,-1184],"id":"6aba93f8-dbd9-4c10-ba4c-b9703e5d22cc","name":"IMAGES_GEN_INLINE_DATA","alwaysOutputData":false},{"parameters":{"assignments":{"assignments":[{"id":"b6c9ed93-e392-42bf-a0ae-94695c98c553","name":"MODEL_ID","value":"=gemini-2.0-flash-preview-image-generation","type":"string"},{"id":"85a1c3f1-045e-41c3-866c-acc1099ff4b3","name":"GENERATE_CONTENT_API","value":"=generateContent","type":"string"},{"id":"4d8ca995-dd5c-459b-b8e4-81a5428e5417","name":"user_prompt","value":"={{ $('IMAGE_INPUT').item.json.message.caption }}","type":"string"},{"id":"26119f8c-2921-4a92-8aa2-39ff85b7263c","name":"system_prompt","value":"=## Bạn là chuyên gia chụp ảnh chuyên nghiệp đồng thời là nhà phân tích ảnh tài ba với hơn 20 năm kinh nghiệm vào nghề.\n## Hãy giúp tôi thực hiện các nhiệm vụ sau:\n - Nhiệm vụ 1: Mỗi khi tôi cung cấp ảnh bạn hãy thực hiện theo yêu cầu như chỉnh sửa ảnh,phân tích ảnh, tạo ảnh tương tự,...\n - Nhiệm vụ 2: Tạo ảnh dựa theo promt của người dùng\n##Promt sinh ảnh bắt buộc phải đầy đủ các thành phần cơ bản sau: \n1. Chủ thể (Subject)\nMô tả chi tiết:\n - Con người Tuổi tác, giới tính, dân tộc, biểu cảm (vui vẻ, trầm tư), trang phục, hành động (đang đọc sách, đang chạy).\n - Động vật: Loài vật, màu lông, hành động.\n - Vật thể: Tên gọi, chất liệu (kim loại, gỗ, thủy tinh), tình trạng (cũ kỹ, bóng loáng).\n Ví dụ:\n `a wise old wizard with a long white beard, wearing blue robes adorned with silver stars` (một pháp sư già thông thái với bộ râu trắng dài, mặc áo choàng xanh dương được trang trí bằng những ngôi sao bạc).\n `a majestic phoenix soaring through the sky, trails of fire coming from its wings` (một con phượng hoàng uy nghi bay vút trên bầu trời, những vệt lửa kéo dài từ đôi cánh).\n2. Phong cách Nghệ thuật (Art Style)\n - Nhiếp ảnh: `photorealistic`, `hyperrealistic`, `documentary photography`, `portrait photography`, `black and white photography`.\n - Hội họa: `oil painting`, `watercolor painting`, `impasto painting`, `by [Tên họa sĩ]` (ví dụ: `by Van Gogh`, `by Rembrandt`).\n - Kỹ thuật số: `digital painting`, `concept art`, `3D render`, `vector art`, `pixel art`.\n - Hoạt hình/Truyện tranh: `anime style`, `Ghibli studio style`, `Disney animation style`, `comic book art`.\n - Khác: `fantasy`, `sci-fi`, `steampunk`, `cyberpunk`, `line art`, `sculpture`.\n Ví dụ:\n `..., digital painting`\n `..., photorealistic`\n `..., anime key visual`\n3. Bối cảnh & Môi trường (Setting & Environment)\nChủ thể của bạn đang ở \"đâu\"?\n - Trong nhà: `in a cozy library`, `inside a futuristic spaceship cockpit`, `in a grand ballroom`.\n - Ngoài trời: `on a misty mountain peak at dawn`, `in a bustling neon-lit Tokyo street at night`, `in an enchanted forest`.\n4. Ánh sáng (Lighting)\nÁnh sáng là yếu tố quyết định cảm xúc (mood) và không khí (atmosphere).\n - Nguồn sáng: `sunlight`, `moonlight`, `candlelight`, `neon lights`, `studio lighting`.\n - Chất lượng ánh sáng: `soft light`, `harsh direct light`, `dramatic lighting`, `cinematic lighting`.\n - Thời điểm: `golden hour` (giờ vàng), `blue hour` (giờ xanh), `midday`, `night`.\n - Hiệu ứng: `volumetric lighting` (ánh sáng khối), `god rays` (tia sáng rọi từ trên cao), `lens flare`.\n Ví dụ:\n `..., dramatic cinematic lighting`\n `..., soft golden hour sunlight`\n5. Bố cục & Góc máy (Composition & Camera Angle)\nBạn muốn người xem nhìn vào chủ thể từ góc độ nào?\n - Góc máy: `close-up shot` (cận cảnh), `medium shot` (trung cảnh), `full-body shot` (toàn thân), `wide shot` (toàn cảnh), `low angle` (góc máy thấp), `high angle` (góc máy cao), `drone view` (nhìn từ trên cao).\n - Bố cục: `rule of thirds` (quy tắc 1/3), `leading lines` (đường dẫn), `symmetry` (đối xứng).\n - Ống kính (Lens): `wide-angle lens` (ống kính góc rộng), `telephoto lens` (ống kính tele), `macro lens` (ống kính macro), `85mm lens`.\n6. Màu sắc (Color Palette)\nMàu sắc giúp tạo ra sự hài hòa và truyền tải cảm xúc.\n `vibrant colors` (màu sắc rực rỡ), `monochromatic` (đơn sắc), `pastel colors` (màu pastel), `warm color palette`, `cool color palette`, `neon palette`.\n7. Mức độ Chi tiết & Chất lượng (Level of Detail & Quality)\nNhững từ khóa \"ma thuật\" giúp đẩy chất lượng ảnh lên cao hơn.\n `highly detailed`, `intricate details`, `sharp focus`, `4K`, `8K`, `UHD`, `masterpiece`, `best quality`, `trending on Artstation`.\n### Kỹ Thuật Nâng Cao\n1. Prompt Phủ định (Negative Prompts)\nSử dụng tham số `--no` (trong Midjourney) hoặc vùng \"Negative Prompt\" (trong Stable Diffusion) để loại bỏ những thứ bạn không muốn xuất hiện.\n Ví dụ: `--no ugly, deformed, blurry, bad anatomy, extra limbs, text, signature` (không có xấu xí, biến dạng, mờ, giải phẫu sai, thừa chi, chữ, chữ ký).\n 2. Trọng số (Prompt Weighting)\nĐể nhấn mạnh một yếu tố nào đó, bạn có thể tăng \"trọng số\" cho nó. (Cú pháp có thể khác nhau giữa các AI).\n Midjourney: `a man holding a ::2 red rose ::1` (nhấn mạnh \"red rose\" gấp đôi so với \"a man holding a\").\n Stable Diffusion: `(red rose:1.3)` (tăng 30% sự quan trọng của \"red rose\").\n 3. Sử dụng các Tham số Kỹ thuật\n Tỷ lệ khung hình: `--ar 16:9` (màn ảnh rộng), `--ar 3:4` (khung dọc), `--ar 1:1` (vuông).\n Seed: Sử dụng cùng một `seed` để tạo ra các biến thể từ một kết quả mà bạn thích, giữ lại bố cục và phong cách.\n Ví dụ Thực Tế: Từ Đơn Giản Đến Chuyên Nghiệp\nHãy cùng xây dựng một prompt hoàn chỉnh.\nÝ tưởng: Một cô gái Việt Nam mặc áo dài trong một khu vườn.\n Prompt Cấp 1 (Đơn giản):\n`a Vietnamese girl in Ao Dai in a garden`\n Prompt Cấp 2 (Thêm chi tiết):\n`a beautiful young Vietnamese woman wearing a white silk Ao Dai, standing in a tranquil garden filled with lotus flowers`\n Prompt Cấp 3 (Chuyên nghiệp):\n`photorealistic portrait of a beautiful young Vietnamese woman with a serene expression, wearing an intricate white silk Ao Dai, standing in a tranquil lotus garden at dawn, soft golden hour sunlight, misty atmosphere, gentle breeze, shot on a Sony a7 III with an 85mm lens, cinematic lighting, sharp focus, highly detailed, 4K --ar 3:4 --no blur, text`\n## Định dạng đầu ra:\n- Nếu yêu cầu phân tích: trả về prompt dạng plainttext hoàn chỉnh với đầy đủ các thành phần bắt buộc sau \n + Chủ thể: `beautiful young Vietnamese woman, serene expression, intricate white silk Ao Dai`\n + Phong cách: `photorealistic portrait, cinematic lighting`\n + Bối cảnh: `tranquil lotus garden at dawn`\n + Ánh sáng: `soft golden hour sunlight`\n + Không khí: `misty atmosphere, gentle breeze`\n + Bố cục/Kỹ thuật: `shot on a Sony a7 III with an 85mm lens, sharp focus`\n + Chất lượng: `highly detailed, 4K, 8k`\n + Tham số:`--ar 3:4;9:16; 16:9; 1:1`\n + Phủ định: `--no blur, text`\n ##Ví dụ mẫu đầu ra: Prompt \"Chân dung thực tế (photorealistic) của một phụ nữ trẻ dân tộc thiểu số Việt Nam, khoảng 20-25 tuổi, với nụ cười rạng rỡ, đôi mắt híp lại vui vẻ, đôi môi đầy đặn màu đỏ tươi để lộ hàm răng trắng đều, làn da sáng hồng tự nhiên, mái tóc đen được vén gọn gàng dưới chiếc mũ đội đầu cầu kỳ. Cô ấy đứng quay mặt về phía trước nhưng hơi nghiêng người sang trái, thân hình hơi xoay về phía người xem, tay phải nhẹ nhàng đưa ra phía trước với lòng bàn tay hơi ngửa, nhìn thẳng vào máy ảnh. Cô ấy mặc trang phục dân tộc truyền thống rực rỡ: một chiếc mũ đội đầu lớn, được thêu họa tiết hình học và hoa văn phức tạp, nổi bật với các màu đỏ, xanh lá, vàng, cam, đen, đính rất nhiều tua rua bằng hạt kim loại hình đồng xu bạc lấp lánh rủ xuống. Cô mặc một chiếc áo khoác ngắn tay dài bằng vải nhung đen, phần cổ và viền tay áo được trang trí bằng các hoa văn thổ cẩm thêu cầu kỳ, đa sắc (đỏ, cam, xanh, vàng, tím), có dải vải màu đỏ tươi viền quanh eo và đeo một chiếc vòng cổ kiềng nhiều tầng màu trắng ngà hoặc bạc ôm sát cổ. Chiếc váy xếp ly ngắn, xòe rộng trên đầu gối, được làm từ vải thổ cẩm với các sọc ngang nhiều màu sắc rực rỡ (xanh dương, xanh lá, đỏ, cam, vàng, đen, trắng) và họa tiết thêu phức tạp. Phía sau váy có một tà vải dài được thêu hoa văn lớn, đối xứng, tông màu tương tự như mũ và tay áo. Eo cô ấy thắt một dải vải thổ cẩm có nhiều đồng xu bạc nhỏ treo lủng lẳng. Chân cô ấy đeo vòng chân hoặc bọc chân bằng vải đen thêu họa tiết, với các dây buộc chéo và hạt kim loại nhỏ rủ xuống. Cô đi dép sandal đế xuồng hoặc dép bệt màu đen quai ngang đơn giản. Bối cảnh là một sườn đồi hoặc triền núi xanh mướt, tươi tốt dưới ánh sáng ban ngày tự nhiên, với nhiều sắc độ xanh khác nhau của thảm thực vật dày đặc và những ngọn đồi uốn lượn ở phía xa tạo nên một phông nền phong phú, nhiều chi tiết. Mặt đất dưới chân cô ấy được bao phủ bởi cỏ tự nhiên và thảm thực vật thưa thớt. Ảnh toàn thân (full-body shot), góc ngang tầm mắt hoặc hơi thấp hơn một chút, nhìn hơi chếch lên, chủ thể được đặt hơi lệch về phía bên phải khung hình theo quy tắc 1/3. Ánh sáng mềm mại, tự nhiên và rực rỡ, đến từ phía trước bên phải, chiếu sáng khuôn mặt và trang phục đầy màu sắc của cô, tạo không khí vui tươi và sống động. Bảng màu tổng thể có độ bão hòa cao và phong phú, nổi bật bởi các màu sắc rực rỡ của trang phục tương phản với màu xanh đậm của cảnh quan tự nhiên. Độ phân giải 8k, siêu chi tiết, lấy nét sắc nét, tông màu da chân thực, màu sắc sống động, nhiếp ảnh chuyên nghiệp, tỉ lệ 9:16.\"","type":"string"},{"id":"2d987f07-904d-4f77-9d4f-f2c239abb47e","name":"api_key_arry","value":"=[\"AIzaSyA55bHb-T_iciXwQVPy03hL4nFlwM8UXr0\"]","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-3808,-1184],"id":"f6e725b7-e6c3-458b-a17c-0acfa2b0682a","name":"INPUT_NORMAL"},{"parameters":{"command":"=python -c'\nimport random\napi_key_array={{ $json.api_key_arry }}\napi_key=random.choice(api_key_array)\nprint(api_key)\n'"},"type":"n8n-nodes-base.executeCommand","typeVersion":1,"position":[-3584,-1184],"id":"efcb2723-4085-4283-aeea-f9ae43e6d1e1","name":"RANDOM_API_KEY"},{"parameters":{"operation":"toBinary","sourceProperty":"data","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-2112,-1264],"id":"d7ca92ba-1b80-4072-a51e-c50f5202de4e","name":"Convert to File"},{"parameters":{"assignments":{"assignments":[{"id":"1425a1f4-c1c6-40f4-8b43-1a5ac14fbd5b","name":"data","value":"={{ $json.candidates[0].content.parts[1].inlineData.data }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2320,-1360],"id":"5f83c731-b766-485d-9ece-161e69a35f54","name":"data"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"736d6f33-e218-4842-88b2-cb377f857700","leftValue":"={{ $json.candidates[0].content.parts[1].inlineData.data }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[-2512,-1360],"id":"e0eefb67-c333-4170-b993-8b32dbe2c995","name":"Filter"},{"parameters":{"operation":"sendPhoto","chatId":"={{ $('IMAGE_INPUT').item.json.message.chat.id }}","binaryData":true,"additionalFields":{"caption":"=IMAGES_GEN_{{ $now.format('yyyy-MM-dd_dd-mm-ss') }}"}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-1904,-1264],"id":"dd3612db-7047-46b0-8f0f-112331f49c41","name":"Send a photo message1","webhookId":"4e239948-6fd9-4cab-882e-a950da595051","credentials":{"telegramApi":{"id":"9JycvKjolJsmovY8","name":"IMAGES_GEN_BOT"}}},{"parameters":{"assignments":{"assignments":[{"id":"1425a1f4-c1c6-40f4-8b43-1a5ac14fbd5b","name":"data","value":"={{ $json.candidates[0].content.parts[0].inlineData.data }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2320,-1120],"id":"66acf796-260d-49d8-9a1b-158a004ea3d3","name":"data1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"736d6f33-e218-4842-88b2-cb377f857700","leftValue":"={{ $json.candidates[0].content.parts[0].inlineData.data }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[-2512,-1120],"id":"d97645cb-e6b8-4c54-a4ad-c2c19258d831","name":"Filter1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"00da2527-c623-4102-a63c-fe499dab8efa","leftValue":"={{ $json.candidates[0].content.parts[1].inlineData }}","rightValue":"","operator":{"type":"object","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-3184,-1184],"id":"489629f6-83cc-483f-82d6-f0a691ce32fc","name":"check_isdata1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1e49e194-af83-40e8-9d8d-bef30c8e68ff","leftValue":"={{ $json.candidates[0].content.parts[0] }}","rightValue":"","operator":{"type":"object","operation":"exists","singleValue":true}},{"id":"8a2cbf6d-e503-4d79-b476-7002d454c17a","leftValue":"={{ $json.candidates[0].content.parts[0].inlineData }}","rightValue":"","operator":{"type":"object","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-2768,-1088],"id":"dd39f44b-5020-4c6d-a9e8-0dcc80036763","name":"check_isdata0"},{"parameters":{"assignments":{"assignments":[{"id":"2ade277f-cde1-4124-afc5-1fed1519f1cf","name":"text","value":"={{ $json.candidates[0].content.parts[0].text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2512,-928],"id":"75be28ed-36e9-42d8-8d0e-76a1cdc27f3d","name":"text"},{"parameters":{"resource":"image","modelId":{"__rl":true,"value":"models/gemini-2.0-flash-preview-image-generation","mode":"list","cachedResultName":"models/gemini-2.0-flash-preview-image-generation"},"prompt":"={{ $json.output }}","options":{}},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[-2880,-672],"id":"155fd7c9-b632-46f7-bd41-c7f8331e9959","name":"Generate an image by model gemini-2.0-flash-exp-image-generation","credentials":{"googlePalmApi":{"id":"mzLiXdDHw88ZBMIG","name":"Google Gemini(PaLM) Api account 1"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"6e5c5fab-1acb-4caf-8554-01bd8b428e06","leftValue":"={{ $('IMAGE_INPUT').item.json.message.text }}","rightValue":"/gpt image 1|gpt-image-1|gpt|gen 4|gen 3|image gen 4|image gen 3|gen4|gen3|gen 4 ultra|image gen 4 utra|gen4u/i","operator":{"type":"string","operation":"notRegex"}}],"combinator":"and"},"renameOutput":true,"outputKey":"free"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('IMAGE_INPUT').item.json.message.text }}","rightValue":"=/gen 3|image gen 3|gen3/i","operator":{"type":"string","operation":"regex"},"id":"6071b41d-5216-4b7f-9bfb-a283824c3717"}],"combinator":"and"},"renameOutput":true,"outputKey":"gen3"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"78c866ac-f06e-4bc2-acf4-6b9485015b97","leftValue":"={{ $('IMAGE_INPUT').item.json.message.text }}","rightValue":"/gen 4|image gen 4|gen4/i","operator":{"type":"string","operation":"regex"}}],"combinator":"and"},"renameOutput":true,"outputKey":"gen4"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"d418bfcd-e63f-473d-876e-f3e62ac90ad4","leftValue":"={{ $('IMAGE_INPUT').item.json.message.text }}","rightValue":"/gen 4 ultra|image gen 4 utra|gen4u/i","operator":{"type":"string","operation":"regex"}}],"combinator":"and"},"renameOutput":true,"outputKey":"gen4u"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8eb3e5f2-8aba-46cd-9c12-b2b5b0b25097","leftValue":"={{ $('IMAGE_INPUT').item.json.message.text }}","rightValue":"=/gpt image 1|gpt-image-1|gpt/i","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"gpt-image-1"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-3248,-448],"id":"1e993d3e-db64-4389-b09d-fac08b5af4b3","name":"select_model"},{"parameters":{"resource":"image","modelId":{"__rl":true,"value":"models/imagen-4.0-generate-preview-06-06","mode":"list","cachedResultName":"models/imagen-4.0-generate-preview-06-06"},"prompt":"={{ $json.output }}","options":{}},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[-2880,-272],"id":"0761457b-4a42-441b-9c6c-8cc804858764","name":"Generate an image by gen4","credentials":{"googlePalmApi":{"id":"Uln34B0gzpcRKe6F","name":"Google Gemini(PaLM) Api pro"}}},{"parameters":{"resource":"image","modelId":{"__rl":true,"value":"models/imagen-4.0-ultra-generate-preview-06-06","mode":"list","cachedResultName":"models/imagen-4.0-ultra-generate-preview-06-06"},"prompt":"={{ $json.output }}","options":{}},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[-2880,-80],"id":"c27247fe-e5cf-4f9d-948c-889f8169b60c","name":"Generate an image by gen4u","credentials":{"googlePalmApi":{"id":"Uln34B0gzpcRKe6F","name":"Google Gemini(PaLM) Api pro"}}},{"parameters":{"chatId":"={{ $json.message.chat.id }}","text":"=Đợi tôi lát nhé!","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-4336,-416],"id":"346677ea-78ac-4fec-bed8-ca0ea43eae9e","name":"WAIT_GEN_IMAGES","webhookId":"75ed27cf-5077-483c-ab4d-35ee6439d593","credentials":{"telegramApi":{"id":"9JycvKjolJsmovY8","name":"IMAGES_GEN_BOT"}}},{"parameters":{"chatId":"={{ $('If').item.json.message.chat.id }}","text":"Đã upload xong file ảnh chờ tôi xử lý giúp.","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-4064,-1184],"id":"21daa965-1fee-4b0a-a510-73b261db5813","name":"Wait_upload_images","webhookId":"60c21060-54f8-40a9-aac2-3b5f5da78d47","credentials":{"telegramApi":{"id":"9JycvKjolJsmovY8","name":"IMAGES_GEN_BOT"}}},{"parameters":{"updates":["message"],"additionalFields":{"download":true}},"type":"n8n-nodes-base.telegramTrigger","typeVersion":1.2,"position":[-4928,-736],"id":"bf619794-f801-49f2-b843-e294de751910","name":"IMAGE_INPUT","webhookId":"a8ee30bc-f63d-4cb0-a158-e766d29fce52","credentials":{"telegramApi":{"id":"9JycvKjolJsmovY8","name":"IMAGES_GEN_BOT"}}},{"parameters":{"model":{"__rl":true,"value":"gpt-5-nano","mode":"list","cachedResultName":"gpt-5-nano"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-4000,-112],"id":"5694beff-0132-480e-82ea-41ef6f67d6d1","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"eCExawqiNAs4gLZS","name":"OpenAi account"}}},{"parameters":{"resource":"image","modelId":{"__rl":true,"value":"models/imagen-3.0-generate-002","mode":"list","cachedResultName":"models/imagen-3.0-generate-002"},"prompt":"={{ $json.output }}","options":{}},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[-2880,-448],"id":"8cd6d029-0c2a-475f-8daf-66f08844b434","name":"Generate an image by gen3","credentials":{"googlePalmApi":{"id":"Uln34B0gzpcRKe6F","name":"Google Gemini(PaLM) Api pro"}}},{"parameters":{"resource":"image","model":"gpt-image-1","prompt":"={{ $json.output }}","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-2880,144],"id":"5ece7475-9304-4aab-b55a-932de9f6b5fb","name":"Generate an image","credentials":{"openAiApi":{"id":"eCExawqiNAs4gLZS","name":"OpenAi account"}}},{"parameters":{"chatId":"={{ $('If').item.json.message.chat.id }}","text":"=<pre><code>{{ $json.text }}</code></pre>","additionalFields":{"appendAttribution":false,"parse_mode":"HTML"}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-2080,-928],"id":"03abcd41-2fe2-4612-adf5-230aad667825","name":"Send a text message","webhookId":"6d7b5805-e6d1-4ecb-8c13-39db37dc24ea","credentials":{"telegramApi":{"id":"9JycvKjolJsmovY8","name":"IMAGES_GEN_BOT"}}}],"connections":{"input_AI_agent":{"main":[[{"node":"AI_AGENT_GEN_IMAGES","type":"main","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"AI_AGENT_GEN_IMAGES","type":"ai_memory","index":0}]]},"AI_AGENT_GEN_IMAGES":{"main":[[{"node":"OUTPUT_AI_AGENT","type":"main","index":0}]]},"OUTPUT_AI_AGENT":{"main":[[{"node":"select_model","type":"main","index":0}]]},"If":{"main":[[{"node":"Upload a file","type":"main","index":0}],[{"node":"WAIT_GEN_IMAGES","type":"main","index":0}]]},"Upload a file":{"main":[[{"node":"Wait_upload_images","type":"main","index":0}]]},"INPUT_NORMAL":{"main":[[{"node":"RANDOM_API_KEY","type":"main","index":0}]]},"RANDOM_API_KEY":{"main":[[{"node":"IMAGES_GEN_INLINE_DATA","type":"main","index":0}]]},"IMAGES_GEN_INLINE_DATA":{"main":[[{"node":"check_isdata1","type":"main","index":0}]]},"data":{"main":[[{"node":"Convert to File","type":"main","index":0}]]},"Filter":{"main":[[{"node":"data","type":"main","index":0}]]},"Convert to File":{"main":[[{"node":"Send a photo message1","type":"main","index":0}]]},"data1":{"main":[[{"node":"Convert to File","type":"main","index":0}]]},"Filter1":{"main":[[{"node":"data1","type":"main","index":0}]]},"check_isdata1":{"main":[[{"node":"Filter","type":"main","index":0}],[{"node":"check_isdata0","type":"main","index":0}]]},"check_isdata0":{"main":[[{"node":"Filter1","type":"main","index":0}],[{"node":"text","type":"main","index":0}]]},"Generate an image by model gemini-2.0-flash-exp-image-generation":{"main":[[{"node":"Send a photo message","type":"main","index":0}]]},"select_model":{"main":[[{"node":"Generate an image by model gemini-2.0-flash-exp-image-generation","type":"main","index":0}],[{"node":"Generate an image by gen3","type":"main","index":0}],[{"node":"Generate an image by gen4","type":"main","index":0}],[{"node":"Generate an image by gen4u","type":"main","index":0}],[{"node":"Generate an image","type":"main","index":0}]]},"Generate an image by gen4":{"main":[[{"node":"Send a photo message","type":"main","index":0}]]},"Generate an image by gen4u":{"main":[[{"node":"Send a photo message","type":"main","index":0}]]},"WAIT_GEN_IMAGES":{"main":[[{"node":"input_AI_agent","type":"main","index":0}]]},"Wait_upload_images":{"main":[[{"node":"INPUT_NORMAL","type":"main","index":0}]]},"text":{"main":[[{"node":"Send a text message","type":"main","index":0}]]},"IMAGE_INPUT":{"main":[[{"node":"If","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI_AGENT_GEN_IMAGES","type":"ai_languageModel","index":0}]]},"Generate an image by gen3":{"main":[[{"node":"Send a photo message","type":"main","index":0}]]},"Generate an image":{"main":[[{"node":"Send a photo message","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"b6e70a79-5f62-4d87-85b0-958c7060a00a","triggerCount":1,"tags":[]}