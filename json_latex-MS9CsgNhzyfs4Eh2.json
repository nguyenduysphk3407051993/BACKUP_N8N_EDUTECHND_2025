{"updatedAt":"2025-11-29T15:25:44.043Z","createdAt":"2025-10-26T05:25:43.765Z","id":"MS9CsgNhzyfs4Eh2","name":"JSON_LATEX","active":true,"isArchived":false,"nodes":[{"parameters":{"mode":"raw","jsonOutput":"=\n{{ $json.output }}\n\n ","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-560,-224],"id":"e291266d-70cd-49ef-a597-897d609d2d85","name":"JSON_LATEX"},{"parameters":{"assignments":{"assignments":[{"id":"6f29acc6-bf36-4ca3-8aa2-23c1d5e4d340","name":"EX","value":"={{ $json.EX }}","type":"string"},{"id":"8a9f4015-3fdd-4b65-95e5-c84218141501","name":"TF","value":"={{ $json.TF }}","type":"string"},{"id":"86e9fb10-eb33-4f8a-92bf-da24f05c25d4","name":"SA","value":"={{ $json.SA }}","type":"string"},{"id":"20125a7a-4644-4573-ad79-b4603d058bba","name":"BT","value":"={{ $json.BT }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[128,-224],"id":"4d92f291-729e-4525-a2a3-ff7ba8bbccc5","name":"CODE_LATEX"},{"parameters":{"assignments":{"assignments":[{"id":"7eac0a9f-8e37-41e3-944f-095f19e44b74","name":"filename_output","value":"=Create_EXAM_{{$now.format('hh_mm_ss-dd_MM_yyyy')}}.tex","type":"string"},{"id":"1c218b8e-1ad2-48f4-96cf-5dc4c5b5d72e","name":"content_to_write","value":"=\\documentclass[FileMain_Ver1.tex]{subfiles}\n\\gdef\\sophong{ {{ $('On form submission').item.json['S·ªü '] }}}\n\\gdef\\truong{ {{ $('On form submission').item.json['Ph√≤ng'] }}}\n\\gdef\\truongh{ {{ $('On form submission').item.json['Tr∆∞·ªùng'] }}}\n\\gdef\\monhoc{ {{ $('On form submission').item.json['M√¥n h·ªçc'] }}}\n\\gdef\\ngaykt{ {{ $('On form submission').item.json['Ng√†y ki·ªÉm tra'] }}}\n\\gdef\\nh{ {{ $('On form submission').item.json['NƒÉm h·ªçc'] }}}\n\\gdef\\thoigian{ {{ $('On form submission').item.json['Th·ªùi gian'] }}}\n\\gdef\\made{ {{ $('On form submission').item.json['M√£ ƒë·ªÅ'] }}}\n\\setcounter{section}{ {{ $('On form submission').item.json['S·ªë th·ª© t·ª± ƒë·ªÅ'] }}}\n\\begin{document}\n\t%%%====Hi·ªÉn th·ªã M·ª•c L·ª•c=======%%%\n\t%\\setcounter{tocdepth}{1}\n\t%\\setcounter{secnumdepth}{3}\n\t%\\tableofcontents\n\t%%%====ƒêi·ªÅu ch·ªânh l·ªùi gi·∫£i=======%%%\n%\t\\tatloigiai\n%\t\\dongkeloigiai\n\t%\\hienthiloigiai\n\t%\\sodongke[4]{ex}\n\t%\\sodongke[8]{bt}\n\t\\section[{{ $('On form submission').item.json['T√™n K√¨ Thi'] }}  l·∫ßn {{ $('On form submission').item.json['S·ªë th·ª© t·ª± k√¨ thi'] }}  - M√£ ƒë·ªÅ \\made] { {{ $('On form submission').item.json['T√™n K√¨ Thi'] }}}\n\t\\subsection{Tr·∫Øc nghi·ªám nhi·ªÅu l·ª±a ch·ªçn.}\\textit{Th√≠ sinh tr·∫£ l·ªùi t·ª´ c√¢u 1 ƒë·∫øn c√¢u 12. \n\tM·ªói c√¢u h·ªèi th√≠ sinh ch·ªâ ch·ªçn m·ªôt ph∆∞∆°ng √°n.} \n\t\n\t\\Opensolutionfile{ansex}[Ans/LGEX-{{ $('On form submission').item.json['T√™n file ƒë√°p √°n'] }}]\n\t\\Opensolutionfile{ans}[Ans/Ans-{{ $('On form submission').item.json['T√™n file ƒë√°p √°n'] }}]\n\t{{ $json.EX }}\n\t\\Closesolutionfile{ans}\n\t\\Closesolutionfile{ansex}\n\t%\\bangdapan{Ans-{{ $('On form submission').item.json['T√™n file ƒë√°p √°n'] }}}\n\t\n\t%%%%==============Ph·∫ßn tr·∫Øc nghi·ªám ƒë√∫ng sai==============%%%    \n\t\\subsection{Tr·∫Øc nghi·ªám ƒë√∫ng sai}\\textit{Th√≠ sinh tr·∫£ l·ªùi t·ª´ c√¢u 1 ƒë·∫øn c√¢u 2 Trong m·ªói √Ω a), b), c), d) ·ªü m·ªói c√¢u, th√≠ sinh ch·ªçn ƒë√∫ng ho·∫∑c sai} \n\t\\Opensolutionfile{ansex}[Ans/LGTF-{{ $('On form submission').item.json['T√™n file ƒë√°p √°n'] }}]\n\t\\Opensolutionfile{ansbook}[Ansbook/AnsTF-{{ $('On form submission').item.json['T√™n file ƒë√°p √°n'] }}]\n\t\\Opensolutionfile{ans}[Ans/Tempt-{{ $('On form submission').item.json['T√™n file ƒë√°p √°n'] }}]\n\t\\setcounter{ex}{0}\n\t\t{{ $json.TF }}\n\t\\Closesolutionfile{ans}\n\t\\Closesolutionfile{ansbook}\n\t\\Closesolutionfile{ansex}\n\t%\t    \\bangdapanTF{AnsTF-{{ $('On form submission').item.json['T√™n file ƒë√°p √°n'] }}}\n\t\n\t%%%==============Ph·∫ßn b√†i t·∫≠p tr·∫£ l·ªùi ng·∫Øn==============%%%    \n\t\\subsection{B√†i t·∫≠p tr·∫£ l·ªùi ng·∫Øn}\\textit{Th√≠ sinh tr·∫£ l·ªùi t·ª´ c√¢u 1 ƒë·∫øn c√¢u 2. }\n\t\\Opensolutionfile{ansex}[Ans/LGSA-{{ $('On form submission').item.json['T√™n file ƒë√°p √°n'] }}]\n\t\\Opensolutionfile{ansexh}[Ans/AnsSA-{{ $('On form submission').item.json['T√™n file ƒë√°p √°n'] }}]\n\t\\setcounter{ex}{0}\n\t\t{{ $json.SA }}\n\t\\Closesolutionfile{ansexh}\n\t\\Closesolutionfile{ansex}\n\t%\\bangdapanSA{AnsSA-{{ $('On form submission').item.json['T√™n file ƒë√°p √°n'] }}}\n\t%    %%%==============Ph·∫ßn b√†i t·∫≠p t·ª± lu·∫≠n==============%%%    \n\t\\subsection{B√†i t·∫≠p t·ª± lu·∫≠n}\\textit{Th√≠ sinh tr√¨nh b√†y l·ªùi gi·∫£i chi ti·∫øt v√†o b√†i l√†m}\n\t\\Opensolutionfile{ansbth}[Ans/LGBT-{{ $('On form submission').item.json['T√™n file ƒë√°p √°n'] }}]\n\t\\Opensolutionfile{ansbt}[Ans/AnsBT-{{ $('On form submission').item.json['T√™n file ƒë√°p √°n'] }}]\n\t\t{{ $json.BT }}\n\t\\Closesolutionfile{ansbt}\n\t\\Closesolutionfile{ansbth}\n\t%\\taodongke[1.5][\\hrule][red]{5}\n%\t\\taodongke[][][black]{56}\n\t%\t\\begin{center}\n\t\t%\t\t \\rule[4pt]{2cm}{1pt}\\,\\bfseries H·∫øt\\,\\rule[4pt]{2cm}{1pt}\n\t\t%\t\\end{center}\n\t%%%%%%%%%%%%%%%%%%%%%%%%\n\t\\label{x}\n\\end{document}\n","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[336,-224],"id":"1664e010-40c6-4e93-811b-2b5c9699ee63","name":"Tempt"},{"parameters":{"fileSelector":"={{ $json.filepath }}","options":{}},"type":"n8n-nodes-base.readWriteFile","typeVersion":1,"position":[1360,-80],"id":"9b38e8ad-d078-4ef8-869c-b86cd543c28d","name":"Read/Write Files from Disk","alwaysOutputData":true},{"parameters":{"jsCode":"// ‚ö° ƒê√¢y l√† h√†m \"th·∫ßn k·ª≥\" gi√∫p chuy·ªÉn ƒë·ªïi text th∆∞·ªùng sang LaTeX kh√¥ng ƒë·∫£o c√°c ph∆∞∆°ng √°n ID EX v√† TF\n// N√≥ s·∫Ω t√¨m c√°c c√¥ng th·ª©c (H_2, Fe^{3+}) v√† c√°c con s·ªë (2, 3) ƒë·ªÉ b·ªçc ch√∫ng b·∫±ng $...$\nconst latexify = (text) => {\n  // 1. Wrap c√°c bi·ªÉu th·ª©c to√°n h·ªçc (v√≠ d·ª•: 2 √ó 2 = 4)\n  // \\u00D7 l√† k√Ω t·ª± '√ó', \\u002A l√† '*'\n  let result = text.replace(/(\\d+\\s*[\\u00D7\\u002A]\\s*\\d+\\s*=\\s*\\d+)/g, '$$$1$$');\n\n  // 2. X·ª≠ l√Ω ph·∫ßn text c√≤n l·∫°i\n  const segments = result.split('$');\n  let finalResult = '';\n\n  // üî•FIX (PH∆Ø∆†NG √ÅN B+): ƒê√£ c·∫≠p nh·∫≠t regex ƒë·ªÉ bao g·ªìm ^ { } + -\n  const formulaRegex = /(?<=^|\\s|\\(|\\[)(?:'|\")?([A-Z][A-Za-z]*[0-9_^][A-Za-z0-9_^\\{\\}+-]*|[0-9]+[A-Z][A-Za-z0-9_^\\{\\}+-]*)(?:'|\")?(?=$|\\s|\\.|\\,|\\:|\\?|\\!|\\)|\\])/g;\n\n\n  for (let i = 0; i < segments.length; i++) {\n    if (i % 2 === 0) {\n      // ƒê√¢y l√† text th∆∞·ªùng (n·∫±m ngo√†i d·∫•u $...$)\n      let temp = segments[i];\n      \n      // 2a. Wrap c√°c c√¥ng th·ª©c h√≥a h·ªçc (d√πng regex m·ªõi)\n      temp = temp.replace(formulaRegex, '$$$1$$');\n      \n      // 2b. Wrap c√°c con s·ªë ƒë·ªôc l·∫≠p\n      const formulaSegments = temp.split('$');\n      let tempResult = '';\n      for (let j = 0; j < formulaSegments.length; j++) {\n        if (j % 2 === 0) {\n          // Text th∆∞·ªùng, wrap s·ªë\n          tempResult += formulaSegments[j].replace(/\\b(\\d+)\\b/g, '$$$1$$');\n        } else {\n          // C√¥ng th·ª©c, gi·ªØ nguy√™n\n          tempResult += `$${formulaSegments[j]}$`;\n        }\n      }\n      finalResult += tempResult;\n      \n    } else {\n      // ƒê√¢y l√† text to√°n h·ªçc (n·∫±m trong d·∫•u $...$), gi·ªØ nguy√™n\n      finalResult += `$${segments[i]}$`;\n    }\n  }\n  // D·ªçn d·∫πp n·∫øu c√≥ $$ tr·ªëng\n  return finalResult.replace(/\\$\\s*\\$/g, ' ');\n};\n\n\n// === PH·∫¶N X·ª¨ L√ù CH√çNH TRONG N8N ===\n\n// L·∫•y d·ªØ li·ªáu t·ª´ T·∫§T C·∫¢ item, b·∫•t k·ªÉ ch·∫ø ƒë·ªô Execute Once\nconst items = $input.all();\nlet allLatexOutputs = [];\n\n// L·∫∑p qua t·ª´ng item (v√≠ d·ª•: n·∫øu node tr∆∞·ªõc tr·∫£ v·ªÅ nhi·ªÅu JSON)\nfor (const item of items) {\n  // üî• C·∫¨P NH·∫¨T: X·ª≠ l√Ω JSON b·ªã l·ªìng (flat map)\n  // D·ªØ li·ªáu JSON c·ªßa b·∫°n c√≥ c·∫•u tr√∫c l·ªìng nhau, ta c·∫ßn l√†m ph·∫≥ng n√≥\n  const rawQuestionData = item.json.cau_hoi_latex;\n  // ƒê·∫£m b·∫£o rawQuestionData l√† m·∫£ng tr∆∞·ªõc khi flatMap\n  const questions = Array.isArray(rawQuestionData) \n    ? rawQuestionData.flatMap(q => q.cau_hoi_latex ? q.cau_hoi_latex : q)\n    : [];\n  \n  // M·∫£ng n√†y s·∫Ω ch·ª©a c√°c chu·ªói LaTeX cho T·ª™NG c√¢u h·ªèi\n  const questionLatexStrings = [];\n\n  // üèóÔ∏è D√πng v√≤ng l·∫∑p for...of ƒë·ªÉ duy·ªát qua t·ª´ng c√¢u h·ªèi\n  for (const question of questions) {\n    \n    // Th√™m header\n    questionLatexStrings.push(`%%%============${question.id}=============%%%`);\n    // üî• C·∫¨P NH·∫¨T: D√πng \\begin{bt} n·∫øu l√† BT, ng∆∞·ª£c l·∫°i d√πng \\begin{ex}\n    if (question.id.includes('BT')) {\n      questionLatexStrings.push(`\\\\begin{bt}`);\n    } else {\n      questionLatexStrings.push(`\\\\begin{ex}`);\n    }\n    \n    // Th√™m ti√™u ƒë·ªÅ (ƒë√£ ƒë∆∞·ª£c \"latexify\")\n    // Th√™m \\n ƒë·ªÉ xu·ªëng d√≤ng cho ƒë·∫πp\n    questionLatexStrings.push(`  ${latexify(question.title)}`);\n    \n    // üî• --- START C·∫¨P NH·∫¨T LOGIC 4 NH√ÅNH (EX, TF, SA, BT) ---\n    const isTrueFalse = question.id.includes('TF');\n    const isShortAnswer = question.id.includes('SA');\n    const isTableExercise = question.id.includes('BT'); // M·ªõi\n    \n    // 1. Th√™m kh·ªëi l·ª±a ch·ªçn \\choice, \\choiceTF, \\shortans, ho·∫∑c kh√¥ng g√¨ c·∫£\n    if (isTrueFalse) {\n      questionLatexStrings.push(`  \\\\choiceTF`);\n    } else if (isShortAnswer) {\n      // L·∫•y ƒë√°p √°n ng·∫Øn t·ª´ \"choices\"\n      const answer = question.choices[0].content;\n      questionLatexStrings.push(`  \\\\shortans{${latexify(answer)}}`);\n    } else if (isTableExercise) {\n      // BT_ type has no choice/shortans block, do nothing.\n    } else { // M·∫∑c ƒë·ªãnh l√† EX\n      questionLatexStrings.push(`  \\\\choice`);\n    }\n    \n    // 2. Loop qua c√°c l·ª±a ch·ªçn (CH·ªà D√ÄNH CHO EX v√† TF)\n    if (!isShortAnswer && !isTableExercise) { // Th√™m !isTableExercise\n      for (const choice of question.choices) {\n        const choicePrefix = choice.correct ? '\\\\True ' : '';\n        let choiceContent = '';\n\n        const testRegex = /^(?:'|\")?([A-Z][A-Za-z]*[0-9_^][A-Za-z0-9_^\\{\\}+-]*|[0-9]+[A-Z][A-Za-z0-9_^\\{\\}+-]*)(?:'|\")?$/;\n        const match = choice.content.match(testRegex);\n        \n        if (match) {\n          choiceContent = `$${match[1]}$`; \n        } else {\n          choiceContent = latexify(choice.content);\n        }\n        \n        questionLatexStrings.push(`  {${choicePrefix}${choiceContent}}`);\n      }\n    }\n    \n    // 3. Th√™m kh·ªëi l·ªùi gi·∫£i\n    questionLatexStrings.push(`  \\\\loigiai{`);\n\n    if (isTrueFalse) {\n      // --- L·ªùi gi·∫£i cho TF ---\n      const keyParts = [];\n      question.choices.forEach((choice, index) => {\n        const letter = choice.correct ? 'T' : 'F';\n        const number = index + 1;\n        keyParts.push(`${letter}${number}`);\n      });\n      const itemChoiceKey = keyParts.join(',');\n      \n      questionLatexStrings.push(`    \\\\begin{itemchoice}[${itemChoiceKey}]`);\n      for (const line of question.explanation) {\n        questionLatexStrings.push(`      \\\\item ${latexify(line)}`);\n      }\n      questionLatexStrings.push(`    \\\\end{itemchoice}`);\n\n    } else if (isShortAnswer) {\n      // --- L·ªùi gi·∫£i cho SA ---\n      // Gh√©p c√°c d√≤ng gi·∫£i th√≠ch th√†nh 1 ƒëo·∫°n vƒÉn\n      const explanationText = question.explanation.map(line => latexify(line)).join(' ');\n      questionLatexStrings.push(`    ${explanationText}`);\n\n    } else {\n      // --- L·ªùi gi·∫£i cho EX v√† BT (d√πng itemize) ---\n      questionLatexStrings.push(`    \\\\begin{itemize}`);\n      for (const line of question.explanation) {\n        questionLatexStrings.push(`      \\\\item ${latexify(line)}`);\n      }\n      questionLatexStrings.push(`    \\\\end{itemize}`);\n    }\n    \n    questionLatexStrings.push(`  }`);\n    \n    // üî• C·∫¨P NH·∫¨T: D√πng \\end{bt} n·∫øu l√† BT, ng∆∞·ª£c l·∫°i d√πng \\end{ex}\n    if (isTableExercise) {\n      questionLatexStrings.push(`\\\\end{bt}`);\n    } else {\n      questionLatexStrings.push(`\\\\end{ex}`);\n    }\n    // üî• --- END C·∫¨P NH·∫¨T ---\n  }\n  \n  // N·ªëi t·∫•t c·∫£ c√°c c√¢u h·ªèi c·ªßa item n√†y l·∫°i, c√°ch nhau 2 d√≤ng m·ªõi\n  allLatexOutputs.push(questionLatexStrings.join('\\n'));\n}\n\n// üöÄ Tr·∫£ v·ªÅ k·∫øt qu·∫£\nreturn [{\n  json: {\n    // N·ªëi k·∫øt qu·∫£ t·ª´ t·∫•t c·∫£ item ƒë·∫ßu v√†o\n    latex_output: allLatexOutputs.join('\\n\\n')\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-416,-448],"id":"1f9d113a-1610-4f1f-9cff-1c8cc646008d","name":"Convert_code_latex_non_dao_pa","disabled":true},{"parameters":{"jsCode":"// ‚ö° ƒê√¢y l√† h√†m \"th·∫ßn k·ª≥\" gi√∫p chuy·ªÉn ƒë·ªïi text th∆∞·ªùng sang LaTeX\n// N√≥ s·∫Ω t√¨m c√°c c√¥ng th·ª©c (H_2, Fe^{3+}) v√† c√°c con s·ªë (2, 3) ƒë·ªÉ b·ªçc ch√∫ng b·∫±ng $...$\nconst latexify = (text) => {\n  // 1. Wrap c√°c bi·ªÉu th·ª©c to√°n h·ªçc (v√≠ d·ª•: 2 √ó 2 = 4)\n  // \\u00D7 l√† k√Ω t·ª± '√ó', \\u002A l√† '*'\n  let result = text.replace(/(\\d+\\s*[\\u00D7\\u002A]\\s*\\d+\\s*=\\s*\\d+)/g, '$$$1$$');\n\n  // 2. X·ª≠ l√Ω ph·∫ßn text c√≤n l·∫°i\n  const segments = result.split('$');\n  let finalResult = '';\n\n  // üî•FIX (PH∆Ø∆†NG √ÅN B+): ƒê√£ c·∫≠p nh·∫≠t regex ƒë·ªÉ bao g·ªìm ^ { } + -\n  const formulaRegex = /(?<=^|\\s|\\(|\\[)(?:'|\")?([A-Z][A-Za-z]*[0-9_^][A-Za-z0-9_^\\{\\}+-]*|[0-9]+[A-Z][A-Za-z0-9_^\\{\\}+-]*)(?:'|\")?(?=$|\\s|\\.|\\,|\\:|\\?|\\!|\\)|\\])/g;\n\n\n  for (let i = 0; i < segments.length; i++) {\n    if (i % 2 === 0) {\n      // ƒê√¢y l√† text th∆∞·ªùng (n·∫±m ngo√†i d·∫•u $...$)\n      let temp = segments[i];\n      \n      // 2a. Wrap c√°c c√¥ng th·ª©c h√≥a h·ªçc (d√πng regex m·ªõi)\n      temp = temp.replace(formulaRegex, '$$$1$$');\n      \n      // 2b. Wrap c√°c con s·ªë ƒë·ªôc l·∫≠p\n      const formulaSegments = temp.split('$');\n      let tempResult = '';\n      for (let j = 0; j < formulaSegments.length; j++) {\n        if (j % 2 === 0) {\n          // Text th∆∞·ªùng, wrap s·ªë\n          tempResult += formulaSegments[j].replace(/\\b(\\d+)\\b/g, '$$$1$$');\n        } else {\n          // C√¥ng th·ª©c, gi·ªØ nguy√™n\n          tempResult += `$${formulaSegments[j]}$`;\n        }\n      }\n      finalResult += tempResult;\n      \n    } else {\n      // ƒê√¢y l√† text to√°n h·ªçc (n·∫±m trong d·∫•u $...$), gi·ªØ nguy√™n\n      finalResult += `$${segments[i]}$`;\n    }\n  }\n  // D·ªçn d·∫πp n·∫øu c√≥ $$ tr·ªëng\n  return finalResult.replace(/\\$\\s*\\$/g, ' ');\n};\n\n// üî• --- START C·∫¨P NH·∫¨T: Th√™m h√†m Shuffle ---\n/**\n * X√°o tr·ªôn m·ªôt m·∫£ng (Fisher-Yates Shuffle).\n * @param {Array} array M·∫£ng c·∫ßn x√°o tr·ªôn.\n */\nconst shuffleArray = (array) => {\n  for (let i = array.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1));\n    [array[i], array[j]] = [array[j], array[i]];\n  }\n};\n// üî• --- END C·∫¨P NH·∫¨T ---\n\n\n// === PH·∫¶N X·ª¨ L√ù CH√çNH TRONG N8N ===\n\n// L·∫•y d·ªØ li·ªáu t·ª´ T·∫§T C·∫¢ item, b·∫•t k·ªÉ ch·∫ø ƒë·ªô Execute Once\nconst items = $input.all();\nlet allLatexOutputs = [];\n\n// L·∫∑p qua t·ª´ng item (v√≠ d·ª•: n·∫øu node tr∆∞·ªõc tr·∫£ v·ªÅ nhi·ªÅu JSON)\nfor (const item of items) {\n  // üî• C·∫¨P NH·∫¨T: X·ª≠ l√Ω JSON b·ªã l·ªìng (flat map)\n  const rawQuestionData = item.json.cau_hoi_latex;\n  // ƒê·∫£m b·∫£o rawQuestionData l√† m·∫£ng tr∆∞·ªõc khi flatMap\n  const questions = Array.isArray(rawQuestionData) \n    ? rawQuestionData.flatMap(q => q.cau_hoi_latex ? q.cau_hoi_latex : q)\n    : [];\n  \n  // M·∫£ng n√†y s·∫Ω ch·ª©a c√°c chu·ªói LaTeX cho T·ª™NG c√¢u h·ªèi\n  const questionLatexStrings = [];\n\n  // üèóÔ∏è D√πng v√≤ng l·∫∑p for...of ƒë·ªÉ duy·ªát qua t·ª´ng c√¢u h·ªèi\n  for (const question of questions) {\n    \n    // Th√™m header\n    questionLatexStrings.push(`%%%============${question.id}=============%%%`);\n    // üî• C·∫¨P NH·∫¨T: D√πng \\begin{bt} n·∫øu l√† BT, ng∆∞·ª£c l·∫°i d√πng \\begin{ex}\n    if (question.id.includes('BT')) {\n      questionLatexStrings.push(`\\\\begin{bt}`);\n    } else {\n      questionLatexStrings.push(`\\\\begin{ex}`);\n    }\n    \n    // Th√™m ti√™u ƒë·ªÅ (ƒë√£ ƒë∆∞·ª£c \"latexify\")\n    questionLatexStrings.push(`  ${latexify(question.title)}`);\n    \n    // --- X√°c ƒë·ªãnh lo·∫°i c√¢u h·ªèi ---\n    const isTrueFalse = question.id.includes('TF');\n    const isShortAnswer = question.id.includes('SA');\n    const isTableExercise = question.id.includes('BT');\n    \n    // üî• --- START C·∫¨P NH·∫¨T: Logic Shuffle ---\n    let processedChoices = question.choices;\n    let processedExplanations = question.explanation;\n    \n    // Ch·ªâ shuffle cho EX v√† TF, v√† ph·∫£i ƒë·∫£m b·∫£o 2 m·∫£ng ƒë·ªìng b·ªô\n    const isShuffleType = (question.id.includes('EX') || isTrueFalse);\n\n    if (isShuffleType && \n        Array.isArray(question.choices) && \n        Array.isArray(question.explanation) && \n        question.choices.length === question.explanation.length) {\n      \n      // 1. \"Zip\" 2 m·∫£ng l·∫°i\n      let combined = question.choices.map((choice, index) => {\n        return {\n          choice: choice,\n          explanation: question.explanation[index]\n        };\n      });\n      \n      // 2. Shuffle m·∫£ng \"zipped\"\n      shuffleArray(combined);\n      \n      // 3. \"Unzip\" m·∫£ng ƒë√£ shuffle\n      processedChoices = combined.map(pair => pair.choice);\n      processedExplanations = combined.map(pair => pair.explanation);\n    }\n    // üî• --- END C·∫¨P NH·∫¨T: Logic Shuffle ---\n    \n    // 1. Th√™m kh·ªëi l·ª±a ch·ªçn \\choice, \\choiceTF, \\shortans, ho·∫∑c kh√¥ng g√¨ c·∫£\n    if (isTrueFalse) {\n      questionLatexStrings.push(`  \\\\choiceTF`);\n    } else if (isShortAnswer) {\n      const answer = processedChoices[0].content; // D√πng processedChoices\n      questionLatexStrings.push(`  \\\\shortans{${latexify(answer)}}`);\n    } else if (isTableExercise) {\n      // BT_ type has no choice/shortans block, do nothing.\n    } else { // M·∫∑c ƒë·ªãnh l√† EX\n      questionLatexStrings.push(`  \\\\choice`);\n    }\n    \n    // 2. Loop qua c√°c l·ª±a ch·ªçn (CH·ªà D√ÄNH CHO EX v√† TF)\n    if (!isShortAnswer && !isTableExercise) {\n      // üî• C·∫¨P NH·∫¨T: D√πng processedChoices\n      for (const choice of processedChoices) {\n        const choicePrefix = choice.correct ? '\\\\True ' : '';\n        let choiceContent = '';\n\n        const testRegex = /^(?:'|\")?([A-Z][A-Za-z]*[0-9_^][A-Za-z0-9_^\\{\\}+-]*|[0-9]+[A-Z][A-Za-z0-9_^\\{\\}+-]*)(?:'|\")?$/;\n        const match = choice.content.match(testRegex);\n        \n        if (match) {\n          choiceContent = `$${match[1]}$`; \n        } else {\n          choiceContent = latexify(choice.content);\n        }\n        \n        questionLatexStrings.push(`  {${choicePrefix}${choiceContent}}`);\n      }\n    }\n    \n    // 3. Th√™m kh·ªëi l·ªùi gi·∫£i\n    questionLatexStrings.push(`  \\\\loigiai{`);\n\n    if (isTrueFalse) {\n      // --- L·ªùi gi·∫£i cho TF ---\n      const keyParts = [];\n      // üî• C·∫¨P NH·∫¨T: D√πng processedChoices ƒë·ªÉ t·∫°o key m·ªõi\n      processedChoices.forEach((choice, index) => {\n        const letter = choice.correct ? 'T' : 'F';\n        const number = index + 1;\n        keyParts.push(`${letter}${number}`);\n      });\n      const itemChoiceKey = keyParts.join(','); // Key m·ªõi: [T1,T2,F3,F4]\n      \n      questionLatexStrings.push(`    \\\\begin{itemchoice}[${itemChoiceKey}]`);\n      // üî• C·∫¨P NH·∫¨T: D√πng processedExplanations\n      for (const line of processedExplanations) {\n        questionLatexStrings.push(`      \\\\item ${latexify(line)}`);\n      }\n      questionLatexStrings.push(`    \\\\end{itemchoice}`);\n\n    } else if (isShortAnswer) {\n      // --- L·ªùi gi·∫£i cho SA ---\n      const explanationText = processedExplanations.map(line => latexify(line)).join(' ');\n      questionLatexStrings.push(`    ${explanationText}`);\n\n    } else {\n      // --- L·ªùi gi·∫£i cho EX v√† BT (d√πng itemize) ---\n      questionLatexStrings.push(`    \\\\begin{itemize}`);\n      // üî• C·∫¨P NH·∫¨T: D√πng processedExplanations\n      for (const line of processedExplanations) {\n        questionLatexStrings.push(`      \\\\item ${latexify(line)}`);\n      }\n      questionLatexStrings.push(`    \\\\end{itemize}`);\n    }\n    \n    questionLatexStrings.push(`  }`);\n    \n    // üî• C·∫¨P NH·∫¨T: D√πng \\end{bt} n·∫øu l√† BT, ng∆∞·ª£c l·∫°i d√πng \\end{ex}\n    if (isTableExercise) {\n      questionLatexStrings.push(`\\\\end{bt}`);\n    } else {\n      questionLatexStrings.push(`\\\\end{ex}`);\n    }\n  }\n  \n  // N·ªëi t·∫•t c·∫£ c√°c c√¢u h·ªèi c·ªßa item n√†y l·∫°i, c√°ch nhau 2 d√≤ng m·ªõi\n  allLatexOutputs.push(questionLatexStrings.join('\\n'));\n}\n\n// üöÄ Tr·∫£ v·ªÅ k·∫øt qu·∫£\nreturn [{\n  json: {\n    // N·ªëi k·∫øt qu·∫£ t·ª´ t·∫•t c·∫£ item ƒë·∫ßu v√†o\n    latex_output: allLatexOutputs.join('\\n\\n')\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-144,-448],"id":"8b328d4a-603e-453f-b906-35ac86c8af11","name":"Convert_to_latex_dao_PA1","disabled":true},{"parameters":{"jsCode":"// ‚ö° ƒê√¢y l√† h√†m \"th·∫ßn k·ª≥\" gi√∫p chuy·ªÉn ƒë·ªïi text th∆∞·ªùng sang LaTeX\n// N√≥ s·∫Ω t√¨m c√°c c√¥ng th·ª©c (H_2, Fe^{3+}) v√† c√°c con s·ªë (2, 3) ƒë·ªÉ b·ªçc ch√∫ng b·∫±ng $...$\nconst latexify = (text) => {\n  // 1. Wrap c√°c bi·ªÉu th·ª©c to√°n h·ªçc (v√≠ d·ª•: 2 √ó 2 = 4)\n  // \\u00D7 l√† k√Ω t·ª± '√ó', \\u002A l√† '*'\n  let result = text.replace(/(\\d+\\s*[\\u00D7\\u002A]\\s*\\d+\\s*=\\s*\\d+)/g, '$$$1$$');\n\n  // 2. X·ª≠ l√Ω ph·∫ßn text c√≤n l·∫°i\n  const segments = result.split('$');\n  let finalResult = '';\n\n  // üî•FIX (PH∆Ø∆†NG √ÅN B+): ƒê√£ c·∫≠p nh·∫≠t regex ƒë·ªÉ bao g·ªìm ^ { } + -\n  const formulaRegex = /(?<=^|\\s|\\(|\\[)(?:'|\")?([A-Z][A-Za-z]*[0-9_^][A-Za-z0-9_^\\{\\}+-]*|[0-9]+[A-Z][A-Za-z0-9_^\\{\\}+-]*)(?:'|\")?(?=$|\\s|\\.|\\,|\\:|\\?|\\!|\\)|\\])/g;\n\n\n  for (let i = 0; i < segments.length; i++) {\n    if (i % 2 === 0) {\n      // ƒê√¢y l√† text th∆∞·ªùng (n·∫±m ngo√†i d·∫•u $...$)\n      let temp = segments[i];\n      \n      // 2a. Wrap c√°c c√¥ng th·ª©c h√≥a h·ªçc (d√πng regex m·ªõi)\n      temp = temp.replace(formulaRegex, '$$$1$$');\n      \n      // 2b. Wrap c√°c con s·ªë ƒë·ªôc l·∫≠p\n      const formulaSegments = temp.split('$');\n      let tempResult = '';\n      for (let j = 0; j < formulaSegments.length; j++) {\n        if (j % 2 === 0) {\n          // Text th∆∞·ªùng, wrap s·ªë\n          tempResult += formulaSegments[j].replace(/\\b(\\d+)\\b/g, '$$$1$$');\n        } else {\n          // C√¥ng th·ª©c, gi·ªØ nguy√™n\n          tempResult += `$${formulaSegments[j]}$`;\n        }\n      }\n      finalResult += tempResult;\n      \n    } else {\n      // ƒê√¢y l√† text to√°n h·ªçc (n·∫±m trong d·∫•u $...$), gi·ªØ nguy√™n\n      finalResult += `$${segments[i]}$`;\n    }\n  }\n  // D·ªçn d·∫πp n·∫øu c√≥ $$ tr·ªëng\n  return finalResult.replace(/\\$\\s*\\$/g, ' ');\n};\n\n// üî• --- START C·∫¨P NH·∫¨T: Th√™m h√†m Shuffle ---\n/**\n * X√°o tr·ªôn m·ªôt m·∫£ng (Fisher-Yates Shuffle).\n * @param {Array} array M·∫£ng c·∫ßn x√°o tr·ªôn.\n */\nconst shuffleArray = (array) => {\n  for (let i = array.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1));\n    [array[i], array[j]] = [array[j], array[i]];\n  }\n};\n// üî• --- END C·∫¨P NH·∫¨T ---\n\n\n// === PH·∫¶N X·ª¨ L√ù CH√çNH TRONG N8N ===\n\n// L·∫•y d·ªØ li·ªáu t·ª´ T·∫§T C·∫¢ item, b·∫•t k·ªÉ ch·∫ø ƒë·ªô Execute Once\nconst items = $input.all();\nlet allLatexOutputs = [];\n\n// L·∫∑p qua t·ª´ng item (v√≠ d·ª•: n·∫øu node tr∆∞·ªõc tr·∫£ v·ªÅ nhi·ªÅu JSON)\nfor (const item of items) {\n  // üî• C·∫¨P NH·∫¨T: X·ª≠ l√Ω JSON b·ªã l·ªìng (flat map)\n  const rawQuestionData = item.json.cau_hoi_latex;\n  // ƒê·∫£m b·∫£o rawQuestionData l√† m·∫£ng tr∆∞·ªõc khi flatMap\n  const questions = Array.isArray(rawQuestionData) \n    ? rawQuestionData.flatMap(q => q.cau_hoi_latex ? q.cau_hoi_latex : q)\n    : [];\n\n  // üî• --- START C·∫¨P NH·∫¨T M·ªöI: X√°o tr·ªôn v·ªã tr√≠ c√°c c√¢u h·ªèi ---\n  // D√≤ng n√†y s·∫Ω x√°o tr·ªôn th·ª© t·ª± c·ªßa [EX_1, EX_2, TF_1, SA_1, BT_1, ...]\n  shuffleArray(questions);\n  // üî• --- END C·∫¨P NH·∫¨T M·ªöI ---\n\n  // M·∫£ng n√†y s·∫Ω ch·ª©a c√°c chu·ªói LaTeX cho T·ª™NG c√¢u h·ªèi\n  const questionLatexStrings = [];\n\n  // üèóÔ∏è D√πng v√≤ng l·∫∑p for...of ƒë·ªÉ duy·ªát qua t·ª´ng c√¢u h·ªèi (theo th·ª© t·ª± ƒë√£ x√°o tr·ªôn)\n  for (const question of questions) {\n    \n    // Th√™m header\n    questionLatexStrings.push(`%%%============${question.id}=============%%%`);\n    // üî• C·∫¨P NH·∫¨T: D√πng \\begin{bt} n·∫øu l√† BT, ng∆∞·ª£c l·∫°i d√πng \\begin{ex}\n    if (question.id.includes('BT')) {\n      questionLatexStrings.push(`\\\\begin{bt}`);\n    } else {\n      questionLatexStrings.push(`\\\\begin{ex}`);\n    }\n    \n    // Th√™m ti√™u ƒë·ªÅ (ƒë√£ ƒë∆∞·ª£c \"latexify\")\n    questionLatexStrings.push(`  ${latexify(question.title)}`);\n    \n    // --- X√°c ƒë·ªãnh lo·∫°i c√¢u h·ªèi ---\n    const isTrueFalse = question.id.includes('TF');\n    const isShortAnswer = question.id.includes('SA');\n    const isTableExercise = question.id.includes('BT');\n    \n    // üî• --- START C·∫¨P NH·∫¨T: Logic Shuffle (b√™n trong c√¢u h·ªèi) ---\n    let processedChoices = question.choices;\n    let processedExplanations = question.explanation;\n    \n    // Ch·ªâ shuffle cho EX v√† TF, v√† ph·∫£i ƒë·∫£m b·∫£o 2 m·∫£ng ƒë·ªìng b·ªô\n    const isShuffleType = (question.id.includes('EX') || isTrueFalse);\n\n    if (isShuffleType && \n        Array.isArray(question.choices) && \n        Array.isArray(question.explanation) && \n        question.choices.length === question.explanation.length) {\n      \n      // 1. \"Zip\" 2 m·∫£ng l·∫°i\n      let combined = question.choices.map((choice, index) => {\n        return {\n          choice: choice,\n          explanation: question.explanation[index]\n        };\n      });\n      \n      // 2. Shuffle m·∫£ng \"zipped\" (Shuffle b√™n trong)\n      shuffleArray(combined);\n      \n      // 3. \"Unzip\" m·∫£ng ƒë√£ shuffle\n      processedChoices = combined.map(pair => pair.choice);\n      processedExplanations = combined.map(pair => pair.explanation);\n    }\n    // üî• --- END C·∫¨P NH·∫¨T: Logic Shuffle (b√™n trong c√¢u h·ªèi) ---\n    \n    // 1. Th√™m kh·ªëi l·ª±a ch·ªçn \\choice, \\choiceTF, \\shortans, ho·∫∑c kh√¥ng g√¨ c·∫£\n    if (isTrueFalse) {\n      questionLatexStrings.push(`  \\\\choiceTF`);\n    } else if (isShortAnswer) {\n      const answer = processedChoices[0].content; // D√πng processedChoices\n      questionLatexStrings.push(`  \\\\shortans{${latexify(answer)}}`);\n    } else if (isTableExercise) {\n      // BT_ type has no choice/shortans block, do nothing.\n    } else { // M·∫∑c ƒë·ªãnh l√† EX\n      questionLatexStrings.push(`  \\\\choice`);\n    }\n    \n    // 2. Loop qua c√°c l·ª±a ch·ªçn (CH·ªà D√ÄNH CHO EX v√† TF)\n    if (!isShortAnswer && !isTableExercise) {\n      // üî• C·∫¨P NH·∫¨T: D√πng processedChoices (ƒë√£ x√°o tr·ªôn)\n      for (const choice of processedChoices) {\n        const choicePrefix = choice.correct ? '\\\\True ' : '';\n        let choiceContent = '';\n\n        const testRegex = /^(?:'|\")?([A-Z][A-Za-z]*[0-9_^][A-Za-z0-9_^\\{\\}+-]*|[0-9]+[A-Z][A-Za-z0-9_^\\{\\}+-]*)(?:'|\")?$/;\n        const match = choice.content.match(testRegex);\n        \n        if (match) {\n          choiceContent = `$${match[1]}$`; \n        } else {\n          choiceContent = latexify(choice.content);\n        }\n        \n        questionLatexStrings.push(`  {${choicePrefix}${choiceContent}}`);\n      }\n    }\n    \n    // 3. Th√™m kh·ªëi l·ªùi gi·∫£i\n    questionLatexStrings.push(`  \\\\loigiai{`);\n\n    if (isTrueFalse) {\n      // --- L·ªùi gi·∫£i cho TF ---\n      const keyParts = [];\n      // üî• C·∫¨P NH·∫¨T: D√πng processedChoices (ƒë√£ x√°o tr·ªôn) ƒë·ªÉ t·∫°o key m·ªõi\n      processedChoices.forEach((choice, index) => {\n        const letter = choice.correct ? 'T' : 'F';\n        const number = index + 1;\n        keyParts.push(`${letter}${number}`);\n      });\n      const itemChoiceKey = keyParts.join(','); // Key m·ªõi: [T1,T2,F3,F4]\n      \n      questionLatexStrings.push(`    \\\\begin{itemchoice}[${itemChoiceKey}]`);\n      // üî• C·∫¨P NH·∫¨T: D√πng processedExplanations (ƒë√£ x√°o tr·ªôn)\n      for (const line of processedExplanations) {\n        questionLatexStrings.push(`      \\\\item ${latexify(line)}`);\n      }\n      questionLatexStrings.push(`    \\\\end{itemchoice}`);\n\n    } else if (isShortAnswer) {\n      // --- L·ªùi gi·∫£i cho SA ---\n      const explanationText = processedExplanations.map(line => latexify(line)).join(' ');\n      questionLatexStrings.push(`    ${explanationText}`);\n\n    } else {\n      // --- L·ªùi gi·∫£i cho EX v√† BT (d√πng itemize) ---\n      questionLatexStrings.push(`    \\\\begin{itemize}`);\n      // üî• C·∫¨P NH·∫¨T: D√πng processedExplanations (ƒë√£ x√°o tr·ªôn n·∫øu l√† EX)\n      for (const line of processedExplanations) {\n        questionLatexStrings.push(`      \\\\item ${latexify(line)}`);\n      }\n      questionLatexStrings.push(`    \\\\end{itemize}`);\n    }\n    \n    questionLatexStrings.push(`  }`);\n    \n    // üî• C·∫¨P NH·∫¨T: D√πng \\end{bt} n·∫øu l√† BT, ng∆∞·ª£c l·∫°i d√πng \\end{ex}\n    if (isTableExercise) {\n      questionLatexStrings.push(`\\\\end{bt}`);\n    } else {\n      questionLatexStrings.push(`\\\\end{ex}`);\n    }\n  }\n  \n  // N·ªëi t·∫•t c·∫£ c√°c c√¢u h·ªèi c·ªßa item n√†y l·∫°i, c√°ch nhau 2 d√≤ng m·ªõi\n  allLatexOutputs.push(questionLatexStrings.join('\\n'));\n}\n\n// üöÄ Tr·∫£ v·ªÅ k·∫øt qu·∫£\nreturn [{\n  json: {\n    // N·ªëi k·∫øt qu·∫£ t·ª´ t·∫•t c·∫£ item ƒë·∫ßu v√†o\n    latex_output: allLatexOutputs.join('\\n\\n')\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[464,-448],"id":"3951e7e7-0274-4999-89ba-595fe662559a","name":"Convert_to_latex_dao_PA_and_dao_cau_hoi","disabled":true},{"parameters":{"jsCode":"// ‚ö° ƒê√¢y l√† h√†m \"th·∫ßn k·ª≥\" gi√∫p chuy·ªÉn ƒë·ªïi text th∆∞·ªùng sang LaTeX\n// N√≥ s·∫Ω t√¨m c√°c c√¥ng th·ª©c (H_2, Fe^{3+}) v√† c√°c con s·ªë (2, 3) ƒë·ªÉ b·ªçc ch√∫ng b·∫±ng $...$\nconst latexify = (text) => {\n  // 1. Wrap c√°c bi·ªÉu th·ª©c to√°n h·ªçc (v√≠ d·ª•: 2 √ó 2 = 4)\n  // \\u00D7 l√† k√Ω t·ª± '√ó', \\u002A l√† '*'\n  let result = text.replace(/(\\d+\\s*[\\u00D7\\u002A]\\s*\\d+\\s*=\\s*\\d+)/g, '$$$1$$');\n\n  // 2. X·ª≠ l√Ω ph·∫ßn text c√≤n l·∫°i\n  const segments = result.split('$');\n  let finalResult = '';\n\n  // üî•FIX (PH∆Ø∆†NG √ÅN B+): ƒê√£ c·∫≠p nh·∫≠t regex ƒë·ªÉ bao g·ªìm ^ { } + -\n  const formulaRegex = /(?<=^|\\s|\\(|\\[)(?:'|\")?([A-Z][A-Za-z]*[0-9_^][A-Za-z0-9_^\\{\\}+-]*|[0-9]+[A-Z][A-Za-z0-9_^\\{\\}+-]*)(?:'|\")?(?=$|\\s|\\.|\\,|\\:|\\?|\\!|\\)|\\])/g;\n\n\n  for (let i = 0; i < segments.length; i++) {\n    if (i % 2 === 0) {\n      // ƒê√¢y l√† text th∆∞·ªùng (n·∫±m ngo√†i d·∫•u $...$)\n      let temp = segments[i];\n      \n      // 2a. Wrap c√°c c√¥ng th·ª©c h√≥a h·ªçc (d√πng regex m·ªõi)\n      temp = temp.replace(formulaRegex, '$$$1$$');\n      \n      // 2b. Wrap c√°c con s·ªë ƒë·ªôc l·∫≠p\n      const formulaSegments = temp.split('$');\n      let tempResult = '';\n      for (let j = 0; j < formulaSegments.length; j++) {\n        if (j % 2 === 0) {\n          // Text th∆∞·ªùng, wrap s·ªë\n          tempResult += formulaSegments[j].replace(/\\b(\\d+)\\b/g, '$$$1$$');\n        } else {\n          // C√¥ng th·ª©c, gi·ªØ nguy√™n\n          tempResult += `$${formulaSegments[j]}$`;\n        }\n      }\n      finalResult += tempResult;\n      \n    } else {\n      // ƒê√¢y l√† text to√°n h·ªçc (n·∫±m trong d·∫•u $...$), gi·ªØ nguy√™n\n      finalResult += `$${segments[i]}$`;\n    }\n  }\n  // D·ªçn d·∫πp n·∫øu c√≥ $$ tr·ªëng\n  return finalResult.replace(/\\$\\s*\\$/g, ' ');\n};\n\n// üî• --- START: Th√™m h√†m Shuffle ---\n/**\n * X√°o tr·ªôn m·ªôt m·∫£ng (Fisher-Yates Shuffle).\n * @param {Array} array M·∫£ng c·∫ßn x√°o tr·ªôn.\n */\nconst shuffleArray = (array) => {\n  for (let i = array.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1));\n    [array[i], array[j]] = [array[j], array[i]];\n  }\n};\n// üî• --- END: Th√™m h√†m Shuffle ---\n\n// üî• --- START: H√†m x·ª≠ l√Ω m·∫£ng c√¢u h·ªèi ---\n/**\n * X·ª≠ l√Ω m·ªôt m·∫£ng c√°c c√¢u h·ªèi v√† tr·∫£ v·ªÅ m·ªôt m·∫£ng c√°c chu·ªói LaTeX.\n * @param {Array} questionArray - M·∫£ng c√°c ƒë·ªëi t∆∞·ª£ng c√¢u h·ªèi (v√≠ d·ª•: exQuestions).\n * @returns {Array<string>} - M·∫£ng c√°c chu·ªói LaTeX ƒë√£ x·ª≠ l√Ω.\n */\nconst processQuestionsToLatex = (questionArray) => {\n  // Bi·∫øn n√†y ch·ª©a T·∫§T C·∫¢ c√°c chu·ªói LaTeX c·ªßa c√°c c√¢u h·ªèi trong nh√≥m n√†y\n  const allQuestionStrings = []; \n  \n  // üèóÔ∏è D√πng v√≤ng l·∫∑p for...of ƒë·ªÉ duy·ªát qua t·ª´ng c√¢u h·ªèi (theo th·ª© t·ª± ƒë√£ x√°o tr·ªôn)\n  for (const question of questionArray) {\n    // üî• FIX L√Ä ·ªû ƒê√ÇY:\n    // Bi·∫øn n√†y CH·ªà ch·ª©a c√°c d√≤ng cho M·ªòT c√¢u h·ªèi\n    const singleQuestionLines = []; \n\n    // Th√™m header\n    singleQuestionLines.push(`%%%============${question.id}=============%%%`);\n    if (question.id.includes('BT')) {\n      singleQuestionLines.push(`\\\\begin{bt}`);\n    } else {\n      singleQuestionLines.push(`\\\\begin{ex}`);\n    }\n    \n    // Th√™m ti√™u ƒë·ªÅ\n    singleQuestionLines.push(`  ${latexify(question.title)}`);\n    \n    // --- X√°c ƒë·ªãnh lo·∫°i c√¢u h·ªèi ---\n    const isTrueFalse = question.id.includes('TF');\n    const isShortAnswer = question.id.includes('SA');\n    const isTableExercise = question.id.includes('BT');\n    \n    // --- Logic Shuffle (b√™n trong c√¢u h·ªèi EX/TF) ---\n    let processedChoices = question.choices;\n    let processedExplanations = question.explanation;\n    \n    const isShuffleType = (question.id.includes('EX') || isTrueFalse);\n\n    if (isShuffleType && \n        Array.isArray(question.choices) && \n        Array.isArray(question.explanation) && \n        question.choices.length === question.explanation.length) {\n      \n      let combined = question.choices.map((choice, index) => {\n        return {\n          choice: choice,\n          explanation: question.explanation[index]\n        };\n      });\n      \n      shuffleArray(combined); // Shuffle b√™n trong\n      \n      processedChoices = combined.map(pair => pair.choice);\n      processedExplanations = combined.map(pair => pair.explanation);\n    }\n    \n    // 1. Th√™m kh·ªëi l·ª±a ch·ªçn\n    if (isTrueFalse) {\n      singleQuestionLines.push(`  \\\\choiceTF`);\n    } else if (isShortAnswer) {\n      const answer = processedChoices[0].content;\n      singleQuestionLines.push(`  \\\\shortans{${latexify(answer)}}`);\n    } else if (isTableExercise) {\n      // BT kh√¥ng c√≥ kh·ªëi l·ª±a ch·ªçn\n    } else { // M·∫∑c ƒë·ªãnh l√† EX\n      singleQuestionLines.push(`  \\\\choice`); // D√πng singleQuestionLines\n    }\n    \n    // 2. Loop qua c√°c l·ª±a ch·ªçn (CH·ªà D√ÄNH CHO EX v√† TF)\n    if (!isShortAnswer && !isTableExercise) {\n      for (const choice of processedChoices) {\n        const choicePrefix = choice.correct ? '\\\\True ' : '';\n        let choiceContent = '';\n        const testRegex = /^(?:'|\")?([A-Z][A-Za-z]*[0-9_^][A-Za-z0-9_^\\{\\}+-]*|[0-9]+[A-Z][A-Za-z0-9_^\\{\\}+-]*)(?:'|\")?$/;\n        const match = choice.content.match(testRegex);\n        \n        if (match) {\n          choiceContent = `$${match[1]}$`; \n        } else {\n          choiceContent = latexify(choice.content);\n        }\n        \n        singleQuestionLines.push(`  {${choicePrefix}${choiceContent}}`); // D√πng singleQuestionLines\n      }\n    }\n    \n    // 3. Th√™m kh·ªëi l·ªùi gi·∫£i\n    singleQuestionLines.push(`  \\\\loigiai{`); // D√πng singleQuestionLines\n\n    if (isTrueFalse) {\n      // --- L·ªùi gi·∫£i cho TF ---\n      const keyParts = [];\n      processedChoices.forEach((choice, index) => {\n        const letter = choice.correct ? 'T' : 'F';\n        const number = index + 1;\n        keyParts.push(`${letter}${number}`);\n      });\n      const itemChoiceKey = keyParts.join(',');\n      \n      singleQuestionLines.push(`    \\\\begin{itemchoice}[${itemChoiceKey}]`);\n      for (const line of processedExplanations) {\n        singleQuestionLines.push(`      \\\\item ${latexify(line)}`);\n      }\n      singleQuestionLines.push(`    \\\\end{itemchoice}`);\n\n    } else if (isShortAnswer) {\n      // --- L·ªùi gi·∫£i cho SA ---\n      const explanationText = processedExplanations.map(line => latexify(line)).join(' ');\n      singleQuestionLines.push(`    ${explanationText}`);\n\n    } else {\n      // --- L·ªùi gi·∫£i cho EX v√† BT (d√πng itemize) ---\n      singleQuestionLines.push(`    \\\\begin{itemize}`);\n      for (const line of processedExplanations) {\n        singleQuestionLines.push(`      \\\\item ${latexify(line)}`);\n      }\n      singleQuestionLines.push(`    \\\\end{itemize}`);\n    }\n    \n    singleQuestionLines.push(`  }`); // D√πng singleQuestionLines\n    \n    // ƒê√≥ng kh·ªëi \\begin\n    if (isTableExercise) {\n      singleQuestionLines.push(`\\\\end{bt}`);\n    } else {\n      singleQuestionLines.push(`\\\\end{ex}`);\n    }\n    \n    // N·ªëi c√°c d√≤ng c·ªßa c√¢u h·ªèi n√†y th√†nh 1 string v√† push v√†o m·∫£ng T·ªîNG\n    allQuestionStrings.push(singleQuestionLines.join('\\n'));\n  }\n  \n  return allQuestionStrings;\n};\n// üî• --- END: H√†m x·ª≠ l√Ω ---\n\n\n// === PH·∫¶N X·ª¨ L√ù CH√çNH TRONG N8N ===\n\n// L·∫•y d·ªØ li·ªáu t·ª´ T·∫§T C·∫¢ item, b·∫•t k·ªÉ ch·∫ø ƒë·ªô Execute Once\nconst items = $input.all();\nlet finalOutput = [];\n\n// L·∫∑p qua t·ª´ng item (v√≠ d·ª•: n·∫øu node tr∆∞·ªõc tr·∫£ v·ªÅ nhi·ªÅu JSON)\nfor (const item of items) {\n  // 1. L·∫•y v√† l√†m ph·∫≥ng data\n  const rawQuestionData = item.json.cau_hoi_latex;\n  const questions = Array.isArray(rawQuestionData) \n    ? rawQuestionData.flatMap(q => q.cau_hoi_latex ? q.cau_hoi_latex : q)\n    : [];\n\n  // 2. T·∫°o 4 m·∫£ng ƒë·ªÉ ph√¢n lo·∫°i\n  const exQuestions = [];\n  const tfQuestions = [];\n  const saQuestions = [];\n  const btQuestions = [];\n\n  // 3. Ph√¢n lo·∫°i c√¢u h·ªèi\n  for (const question of questions) {\n    if (question.id.includes('BT')) {\n      btQuestions.push(question);\n    } else if (question.id.includes('TF')) {\n      tfQuestions.push(question);\n    } else if (question.id.includes('SA')) {\n      saQuestions.push(question);\n    } else { // M·∫∑c ƒë·ªãnh l√† EX\n      exQuestions.push(question);\n    }\n  }\n\n  // 4. X√°o tr·ªôn c√°c c√¢u h·ªèi *trong* t·ª´ng nh√≥m\n  shuffleArray(exQuestions);\n  shuffleArray(tfQuestions);\n  shuffleArray(saQuestions);\n  shuffleArray(btQuestions);\n\n  // 5. X·ª≠ l√Ω t·ª´ng nh√≥m ƒë√£ x√°o tr·ªôn ƒë·ªÉ t·∫°o m·∫£ng string LaTeX\n  const exOutput = processQuestionsToLatex(exQuestions);\n  const tfOutput = processQuestionsToLatex(tfQuestions);\n  const saOutput = processQuestionsToLatex(saQuestions);\n  const btOutput = processQuestionsToLatex(btQuestions);\n\n  // 6. Push k·∫øt qu·∫£ c·ªßa item n√†y v√†o\n  finalOutput.push({\n    json: {\n      EX: exOutput,\n      TF: tfOutput,\n      SA: saOutput,\n      BT: btOutput\n    }\n  });\n}\n\n// üöÄ Tr·∫£ v·ªÅ k·∫øt qu·∫£\n// Tr·∫£ v·ªÅ m·ªôt m·∫£ng c√°c object, m·ªói object t∆∞∆°ng ·ª©ng v·ªõi m·ªôt item ƒë·∫ßu v√†o\n// v√† ch·ª©a 4 m·∫£ng ƒë√£ ƒë∆∞·ª£c ph√¢n lo·∫°i\nreturn finalOutput;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[144,-448],"id":"fcc4b2fd-35ae-46cc-99c5-5b28b13759cf","name":"Convert_to_latex_dao_PA_and_dao_cau_hoi_theo_ID","disabled":true},{"parameters":{"jsCode":"// ‚ö° ƒê√¢y l√† h√†m \"th·∫ßn k·ª≥\" gi√∫p chuy·ªÉn ƒë·ªïi text th∆∞·ªùng sang LaTeX\n// N√≥ s·∫Ω t√¨m c√°c c√¥ng th·ª©c (H_2, Fe^{3+}) v√† c√°c con s·ªë (2, 3) ƒë·ªÉ b·ªçc ch√∫ng b·∫±ng $...$\nconst latexify = (text) => {\n  // 1. Wrap c√°c bi·ªÉu th·ª©c to√°n h·ªçc (v√≠ d·ª•: 2 √ó 2 = 4)\n  // \\u00D7 l√† k√Ω t·ª± '√ó', \\u002A l√† '*'\n  let result = text.replace(/(\\d+\\s*[\\u00D7\\u002A]\\s*\\d+\\s*=\\s*\\d+)/g, '$$$1$$');\n\n  // 2. X·ª≠ l√Ω ph·∫ßn text c√≤n l·∫°i\n  const segments = result.split('$');\n  let finalResult = '';\n\n  // üî•FIX (PH∆Ø∆†NG √ÅN B+): ƒê√£ c·∫≠p nh·∫≠t regex ƒë·ªÉ bao g·ªìm ^ { } + -\n  const formulaRegex = /(?<=^|\\s|\\(|\\[)(?:'|\")?([A-Z][A-Za-z]*[0-9_^][A-Za-z0-9_^\\{\\}+-]*|[0-9]+[A-Z][A-Za-z0-9_^\\{\\}+-]*)(?:'|\")?(?=$|\\s|\\.|\\,|\\:|\\?|\\!|\\)|\\])/g;\n\n\n  for (let i = 0; i < segments.length; i++) {\n    if (i % 2 === 0) {\n      // ƒê√¢y l√† text th∆∞·ªùng (n·∫±m ngo√†i d·∫•u $...$)\n      let temp = segments[i];\n      \n      // 2a. Wrap c√°c c√¥ng th·ª©c h√≥a h·ªçc (d√πng regex m·ªõi)\n      temp = temp.replace(formulaRegex, '$$$1$$');\n      \n      // 2b. Wrap c√°c con s·ªë ƒë·ªôc l·∫≠p\n      const formulaSegments = temp.split('$');\n      let tempResult = '';\n      for (let j = 0; j < formulaSegments.length; j++) {\n        if (j % 2 === 0) {\n          // Text th∆∞·ªùng, wrap s·ªë\n          tempResult += formulaSegments[j].replace(/\\b(\\d+)\\b/g, '$$$1$$');\n        } else {\n          // C√¥ng th·ª©c, gi·ªØ nguy√™n\n          tempResult += `$${formulaSegments[j]}$`;\n        }\n      }\n      finalResult += tempResult;\n      \n    } else {\n      // ƒê√¢y l√† text to√°n h·ªçc (n·∫±m trong d·∫•u $...$), gi·ªØ nguy√™n\n      finalResult += `$${segments[i]}$`;\n    }\n  }\n  // D·ªçn d·∫πp n·∫øu c√≥ $$ tr·ªëng\n  return finalResult.replace(/\\$\\s*\\$/g, ' ');\n};\n\n// üî• --- START: Th√™m h√†m Shuffle (D√πng ƒë·ªÉ x√°o tr·ªôn l·ª±a ch·ªçn b√™n trong) ---\n/**\n * X√°o tr·ªôn m·ªôt m·∫£ng (Fisher-Yates Shuffle).\n * @param {Array} array M·∫£ng c·∫ßn x√°o tr·ªôn.\n */\nconst shuffleArray = (array) => {\n  for (let i = array.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1));\n    [array[i], array[j]] = [array[j], array[i]];\n  }\n};\n// üî• --- END: Th√™m h√†m Shuffle ---\n\n// üî• --- START C·∫¨P NH·∫¨T M·ªöI: Th√™m h√†m l·∫•y s·ªë ID ---\n/**\n * L·∫•y ph·∫ßn s·ªë t·ª´ ID (v√≠ d·ª•: \"EX_10\" -> 10) ƒë·ªÉ s·∫Øp x·∫øp\n * @param {string} id\n * @returns {number}\n */\nconst getIdNumber = (id) => {\n  if (typeof id !== 'string') return 0;\n  const parts = id.split('_');\n  // L·∫•y ph·∫ßn t·ª≠ cu·ªëi c√πng (ph√≤ng tr∆∞·ªùng h·ª£p ID nh∆∞ \"SOME_TF_1\")\n  return parseInt(parts[parts.length - 1] || 0, 10);\n};\n// üî• --- END C·∫¨P NH·∫¨T M·ªöI ---\n\n\n// üî• --- START: H√†m x·ª≠ l√Ω m·∫£ng c√¢u h·ªèi ---\n/**\n * X·ª≠ l√Ω m·ªôt m·∫£ng c√°c c√¢u h·ªèi v√† tr·∫£ v·ªÅ m·ªôt m·∫£ng c√°c chu·ªói LaTeX.\n * @param {Array} questionArray - M·∫£ng c√°c ƒë·ªëi t∆∞·ª£ng c√¢u h·ªèi (v√≠ d·ª•: exQuestions).\n * @returns {Array<string>} - M·∫£ng c√°c chu·ªói LaTeX ƒë√£ x·ª≠ l√Ω.\n */\nconst processQuestionsToLatex = (questionArray) => {\n  // Bi·∫øn n√†y ch·ª©a T·∫§T C·∫¢ c√°c chu·ªói LaTeX c·ªßa c√°c c√¢u h·ªèi trong nh√≥m n√†y\n  const allQuestionStrings = []; \n  \n  // üèóÔ∏è D√πng v√≤ng l·∫∑p for...of ƒë·ªÉ duy·ªát qua t·ª´ng c√¢u h·ªèi (theo th·ª© t·ª± ƒë√£ S·∫ÆP X·∫æP)\n  for (const question of questionArray) {\n    // Bi·∫øn n√†y CH·ªà ch·ª©a c√°c d√≤ng cho M·ªòT c√¢u h·ªèi\n    const singleQuestionLines = []; \n\n    // Th√™m header\n    singleQuestionLines.push(`%%%============${question.id}=============%%%`);\n    if (question.id.includes('BT')) {\n      singleQuestionLines.push(`\\\\begin{bt}`);\n    } else {\n      singleQuestionLines.push(`\\\\begin{ex}`);\n    }\n    \n    // Th√™m ti√™u ƒë·ªÅ\n    singleQuestionLines.push(`  ${latexify(question.title)}`);\n    \n    // --- X√°c ƒë·ªãnh lo·∫°i c√¢u h·ªèi ---\n    const isTrueFalse = question.id.includes('TF');\n    const isShortAnswer = question.id.includes('SA');\n    const isTableExercise = question.id.includes('BT');\n    \n    // --- Logic Shuffle (b√™n trong c√¢u h·ªèi EX/TF) ---\n    let processedChoices = question.choices;\n    let processedExplanations = question.explanation;\n    \n    const isShuffleType = (question.id.includes('EX') || isTrueFalse);\n\n    if (isShuffleType && \n        Array.isArray(question.choices) && \n        Array.isArray(question.explanation) && \n        question.choices.length === question.explanation.length) {\n      \n      let combined = question.choices.map((choice, index) => {\n        return {\n          choice: choice,\n          explanation: question.explanation[index]\n        };\n      });\n      \n      shuffleArray(combined); // Shuffle b√™n trong\n      \n      processedChoices = combined.map(pair => pair.choice);\n      processedExplanations = combined.map(pair => pair.explanation);\n    }\n    \n    // 1. Th√™m kh·ªëi l·ª±a ch·ªçn\n    if (isTrueFalse) {\n      singleQuestionLines.push(`  \\\\choiceTF`);\n    } else if (isShortAnswer) {\n      const answer = processedChoices[0].content;\n      singleQuestionLines.push(`  \\\\shortans{${latexify(answer)}}`);\n    } else if (isTableExercise) {\n      // BT kh√¥ng c√≥ kh·ªëi l·ª±a ch·ªçn\n    } else { // M·∫∑c ƒë·ªãnh l√† EX\n      singleQuestionLines.push(`  \\\\choice`); \n    }\n    \n    // 2. Loop qua c√°c l·ª±a ch·ªçn (CH·ªà D√ÄNH CHO EX v√† TF)\n    if (!isShortAnswer && !isTableExercise) {\n      for (const choice of processedChoices) {\n        const choicePrefix = choice.correct ? '\\\\True ' : '';\n        let choiceContent = '';\n        const testRegex = /^(?:'|\")?([A-Z][A-Za-z]*[0-9_^][A-Za-z0-9_^\\{\\}+-]*|[0-9]+[A-Z][A-Za-z0-9_^\\{\\}+-]*)(?:'|\")?$/;\n        const match = choice.content.match(testRegex);\n        \n        if (match) {\n          choiceContent = `$${match[1]}$`; \n        } else {\n          choiceContent = latexify(choice.content);\n        }\n        \n        singleQuestionLines.push(`  {${choicePrefix}${choiceContent}}`); \n      }\n    }\n    \n    // 3. Th√™m kh·ªëi l·ªùi gi·∫£i\n    singleQuestionLines.push(`  \\\\loigiai{`); \n\n    if (isTrueFalse) {\n      // --- L·ªùi gi·∫£i cho TF ---\n      const keyParts = [];\n      processedChoices.forEach((choice, index) => {\n        const letter = choice.correct ? 'T' : 'F';\n        const number = index + 1;\n        keyParts.push(`${letter}${number}`);\n      });\n      const itemChoiceKey = keyParts.join(',');\n      \n      singleQuestionLines.push(`    \\\\begin{itemchoice}[${itemChoiceKey}]`);\n      for (const line of processedExplanations) {\n        singleQuestionLines.push(`      \\\\item ${latexify(line)}`);\n      }\n      singleQuestionLines.push(`    \\\\end{itemchoice}`);\n\n    } else if (isShortAnswer) {\n      // --- L·ªùi gi·∫£i cho SA ---\n      const explanationText = processedExplanations.map(line => latexify(line)).join(' ');\n      singleQuestionLines.push(`    ${explanationText}`);\n\n    } else {\n      // --- L·ªùi gi·∫£i cho EX v√† BT (d√πng itemize) ---\n      singleQuestionLines.push(`    \\\\begin{itemize}`);\n      for (const line of processedExplanations) {\n        singleQuestionLines.push(`      \\\\item ${latexify(line)}`);\n      }\n      singleQuestionLines.push(`    \\\\end{itemize}`);\n    }\n    \n    singleQuestionLines.push(`  }`); \n    \n    // ƒê√≥ng kh·ªëi \\begin\n    if (isTableExercise) {\n      singleQuestionLines.push(`\\\\end{bt}`);\n    } else {\n      singleQuestionLines.push(`\\\\end{ex}`);\n    }\n    \n    // N·ªëi c√°c d√≤ng c·ªßa c√¢u h·ªèi n√†y th√†nh 1 string v√† push v√†o m·∫£ng T·ªîNG\n    allQuestionStrings.push(singleQuestionLines.join('\\n'));\n  }\n  \n  return allQuestionStrings;\n};\n// üî• --- END: H√†m x·ª≠ l√Ω ---\n\n\n// === PH·∫¶N X·ª¨ L√ù CH√çNH TRONG N8N ===\n\n// L·∫•y d·ªØ li·ªáu t·ª´ T·∫§T C·∫¢ item, b·∫•t k·ªÉ ch·∫ø ƒë·ªô Execute Once\nconst items = $input.all();\nlet finalOutput = [];\n\n// L·∫∑p qua t·ª´ng item (v√≠ d·ª•: n·∫øu node tr∆∞·ªõc tr·∫£ v·ªÅ nhi·ªÅu JSON)\nfor (const item of items) {\n  // 1. L·∫•y v√† l√†m ph·∫≥ng data\n  const rawQuestionData = item.json.cau_hoi_latex;\n  const questions = Array.isArray(rawQuestionData) \n    ? rawQuestionData.flatMap(q => q.cau_hoi_latex ? q.cau_hoi_latex : q)\n    : [];\n\n  // 2. T·∫°o 4 m·∫£ng ƒë·ªÉ ph√¢n lo·∫°i\n  const exQuestions = [];\n  const tfQuestions = [];\n  const saQuestions = [];\n  const btQuestions = [];\n\n  // 3. Ph√¢n lo·∫°i c√¢u h·ªèi\n  for (const question of questions) {\n    if (question.id.includes('BT')) {\n      btQuestions.push(question);\n    } else if (question.id.includes('TF')) {\n      tfQuestions.push(question);\n    } else if (question.id.includes('SA')) {\n      saQuestions.push(question);\n    } else { // M·∫∑c ƒë·ªãnh l√† EX\n      exQuestions.push(question);\n    }\n  }\n\n  // 4. üî• C·∫¨P NH·∫¨T M·ªöI: S·∫Øp x·∫øp c√°c c√¢u h·ªèi *trong* t·ª´ng nh√≥m theo ID\n  const sortById = (a, b) => getIdNumber(a.id) - getIdNumber(b.id);\n  exQuestions.sort(sortById);\n  tfQuestions.sort(sortById);\n  saQuestions.sort(sortById);\n  btQuestions.sort(sortById);\n\n  // 5. X·ª≠ l√Ω t·ª´ng nh√≥m ƒë√£ S·∫ÆP X·∫æP ƒë·ªÉ t·∫°o m·∫£ng string LaTeX\n  const exOutput = processQuestionsToLatex(exQuestions);\n  const tfOutput = processQuestionsToLatex(tfQuestions);\n  const saOutput = processQuestionsToLatex(saQuestions);\n  const btOutput = processQuestionsToLatex(btQuestions);\n\n  // 6. Push k·∫øt qu·∫£ c·ªßa item n√†y v√†o\n  finalOutput.push({\n    json: {\n      EX: exOutput,\n      TF: tfOutput,\n      SA: saOutput,\n      BT: btOutput\n    }\n  });\n}\n\n// üöÄ Tr·∫£ v·ªÅ k·∫øt qu·∫£\n// Tr·∫£ v·ªÅ m·ªôt m·∫£ng c√°c object, m·ªói object t∆∞∆°ng ·ª©ng v·ªõi m·ªôt item ƒë·∫ßu v√†o\n// v√† ch·ª©a 4 m·∫£ng ƒë√£ ƒë∆∞·ª£c ph√¢n lo·∫°i\nreturn finalOutput;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-304,-224],"id":"9b8b0869-594f-486a-b44a-b325395cec02","name":"Convert_to_latex_dao_PA_and_dao_cau_hoi_theo_ID_INDEX"},{"parameters":{"jsCode":"// L·∫•y d·ªØ li·ªáu t·ª´ T·∫§T C·∫¢ item, b·∫•t k·ªÉ ch·∫ø ƒë·ªô Execute Once\nconst items = $input.all();\n\n// üí° D·ªØ li·ªáu c·ªßa b·∫°n l√† m·ªôt m·∫£ng [ { ... } ], ch√∫ng ta c·∫ßn l·∫•y object ƒë·∫ßu ti√™n\nconst inputData = items[0].json;\n\n// 1. Kh·ªüi t·∫°o object k·∫øt qu·∫£\nconst outputObject = {\n  \"EX\": \"\",\n  \"TF\": \"\",\n  \"SA\": \"\",\n  \"BT\": \"\"\n};\n\n// 2. ƒê·ªãnh nghƒ©a c√°c key ch√∫ng ta mu·ªën x·ª≠ l√Ω\nconst keysToProcess = ['EX', 'TF', 'SA', 'BT'];\n\n// üèóÔ∏è D√πng v√≤ng l·∫∑p 'for...of' (m·ªôt d·∫°ng 'for' hi·ªán ƒë·∫°i) ƒë·ªÉ duy·ªát qua c√°c key\nfor (const key of keysToProcess) {\n  \n  // L·∫•y m·∫£ng t∆∞∆°ng ·ª©ng (v√≠ d·ª•: inputData['EX'])\n  const stringArray = inputData[key];\n  \n  // T·∫°o m·ªôt chu·ªói r·ªóng ƒë·ªÉ \"c·ªông d·ªìn\"\n  let concatenatedString = \"\";\n\n  // üèóÔ∏è D√πng v√≤ng l·∫∑p 'for' c·ªï ƒëi·ªÉn (nh∆∞ b·∫°n y√™u c·∫ßu) ƒë·ªÉ duy·ªát qua t·ª´ng ph·∫ßn t·ª≠\n  for (let i = 0; i < stringArray.length; i++) {\n    \n    // N·ªëi (c·ªông) chu·ªói hi·ªán t·∫°i v√†o chu·ªói t·ªïng\n    concatenatedString += stringArray[i];\n    \n    // Th√™m 2 d·∫•u xu·ªëng d√≤ng ƒë·ªÉ ngƒÉn c√°ch c√°c c√¢u h·ªèi cho d·ªÖ ƒë·ªçc\n    // (B·ªè qua n·∫øu l√† ph·∫ßn t·ª≠ cu·ªëi c√πng)\n    if (i < stringArray.length - 1) {\n      concatenatedString += \"\\n\\n\";\n    }\n  }\n  \n  // 3. G√°n chu·ªói ƒë√£ n·ªëi v√†o object k·∫øt qu·∫£\n  outputObject[key] = concatenatedString;\n}\n\n// 4. üöÄ Tr·∫£ v·ªÅ k·∫øt qu·∫£\n// Ch√∫ng ta tr·∫£ v·ªÅ m·ªôt item duy nh·∫•t ch·ª©a object b·∫°n mong mu·ªën\nreturn [{\n  json: outputObject\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-48,-224],"id":"58389f5e-3cd2-4b5d-90f7-ef7af74d29a8","name":"JOIN"},{"parameters":{"promptType":"define","text":"={{ $json.PROMPT }}","hasOutputParser":true,"options":{"systemMessage":"=## Chuy√™n gia So·∫°n th·∫£o C√¢u h·ªèi JSON/LaTeX\nB·∫°n l√† chuy√™n gia v·ªÅ d·ªØ li·ªáu **JSON** trong javascript v√† so·∫°n th·∫£o **LaTeX**, v·ªõi n·ªôi dung c√°c c√¢u h·ªèi b√†i t·∫≠p theo t·ª´ng ch·ªß ƒë·ªÅ cho c√°c m√¥n h·ªçc nh∆∞ to√°n, v·∫≠t l√Ω, h√≥a, sinh, khoa h·ªçc t·ª± nhi√™n thu·ªôc ch∆∞∆°ng tr√¨nh **l·ªõp 6, 7, 8, 9, v√† 10,11,12**.\n---\n## C·∫•u tr√∫c v√† Ph√¢n lo·∫°i C√¢u h·ªèi\nH·ªá th·ªëng s·ª≠ d·ª•ng 4 lo·∫°i c√¢u h·ªèi, t·∫•t c·∫£ ƒë∆∞·ª£c x√¢y d·ª±ng theo c·∫•u tr√∫c d·ªØ li·ªáu JSON. M·ªói lo·∫°i ƒë∆∞·ª£c x√°c ƒë·ªãnh b·∫±ng m·ªôt ti·ªÅn t·ªë ID (m√£ nh·∫≠n d·∫°ng) duy nh·∫•t:\n* **Lo·∫°i 1:** ID b·∫Øt ƒë·∫ßu b·∫±ng `EX`.\n* **Lo·∫°i 2:** ID b·∫Øt ƒë·∫ßu b·∫±ng `TF`.\n* **Lo·∫°i 3:** ID b·∫Øt ƒë·∫ßu b·∫±ng `SA`.\n* **Lo·∫°i 4:** ID b·∫Øt ƒë·∫ßu b·∫±ng `BT`.\n## Quy t·∫Øc So·∫°n th·∫£o LaTeX üìù\nN·ªôi dung c√°c ph∆∞∆°ng √°n, l·ªùi gi·∫£i  c·ªßa t·∫•t c·∫£ c√°c c√¢u h·ªèi ph·∫£i ƒë∆∞·ª£c vi·∫øt b·∫±ng m√£ LaTeX v√† tu√¢n th·ªß nghi√™m ng·∫∑t c√°c quy t·∫Øc sau ƒë·ªÉ ƒë·∫£m b·∫£o tr√¨nh bi√™n d·ªãch kh√¥ng b√°o l·ªói:\n1.  **T√≠nh h·ª£p l·ªá:** M√£ LaTeX ph·∫£i ho√†n to√†n ch√≠nh x√°c v√† h·ª£p l·ªá.\n2.  **C√¥ng th·ª©c Inline:** C√°c c√¥ng th·ª©c, k√Ω hi·ªáu to√°n h·ªçc n·∫±m **tr√™n c√πng m·ªôt d√≤ng** v·ªõi vƒÉn b·∫£n ph·∫£i ƒë∆∞·ª£c b·ªçc trong c·∫∑p d·∫•u: `$ ... $`.\n3.  **C√¥ng th·ª©c Display:** C√°c c√¥ng th·ª©c, ph∆∞∆°ng tr√¨nh ƒë∆∞·ª£c hi·ªÉn th·ªã **tr√™n m·ªôt d√≤ng ri√™ng bi·ªát** (th∆∞·ªùng ƒë∆∞·ª£c cƒÉn gi·ªØa) ph·∫£i ƒë∆∞·ª£c b·ªçc trong c·∫∑p d·∫•u: `\\[ ... \\]`.\n\n##Y√™u c·∫ßu v·ªÅ n·ªôi dung:\n1. C√°c s·ªë,c√¥ng th·ª©c, k√≠ hi·ªáu  inline ph·∫£i b·ªçc trong c·∫∑p $...$ , c√°c c√¥ng th·ª©c display b·ªçc b·ªüi \\[...\\] thay v√¨ b·ªçc b·ªüi $$...$$.N·∫øu s·ªë th·∫≠p ph√¢n th√¨ d√πng \"{,}\" thay v√¨ \",\" ƒë·ªÉ ngƒÉn ph·∫ßn nguy√™n v√† ph·∫ßn th·∫≠p ph√¢n $3{,}14$ thay v√¨ $3.14$\n2. C√°c c√¥ng th·ª©c nhi·ªÅu d√≤ng ph·∫£i d√πng m√¥i tr∆∞·ªùng eqnarray* ƒë·ªÉ cƒÉn d√≥ng:\nV√≠ d·ª•:\n\\begin{eqnarray*}\n  f(x) & = & (x+1)^2 \\\\\n       & = & x^2 + 2x + 1 \\\\\n       & = & (x^2 + x) + (x + 1)\n\\end{eqnarray*}\n3. ƒê·ªëi v·ªõi b·∫£ng, d√πng m√¥i tr∆∞·ªùng tabular latex ƒë·ªÉ so·∫°n th·∫£o:\nV√≠ d·ª•\n\\begin{center}\n\t\\begin{tabular}{|c|c|c|c|}\n\t\t\\hline\n\t\t& $C-C$ & $C=C$ & C$\\equiv$C \\\\\n\t\t\\hline\n\t\tƒê·ªô d√†i li√™n k·∫øt ($A^{o}$) & $1{,}54$ & $1{,}34$ & $1{,}20$ \\\\\n\t\t\\hline\n\t\tNƒÉng l∆∞·ª£ng li√™n k·∫øt ($kJ/mol$) & $347$ & $614$ & $839$ \\\\\n\t\t\\hline\n\t\\end{tabular}\n\\end{center}\nho·∫∑c n·∫øu n·ªôi dung nhi·ªÅu trang d√πng m√¥i tr∆∞·ªùng longtable\n\\begin{longtable}{|c|c|c|}\n  \\hline\n  \\textbf{STT} & \\textbf{H·ªç v√† t√™n} & \\textbf{ƒêi·ªÉm} \\\\\n  \\hline\n  \\endfirsthead % Ph·∫ßn ƒë·∫ßu ti√™n c·ªßa b·∫£ng (hi·ªÉn th·ªã tr√™n trang ƒë·∫ßu ti√™n)\n  \\hline\n  \\textbf{STT} & \\textbf{H·ªç v√† t√™n} & \\textbf{ƒêi·ªÉm} \\\\\n  \\hline\n  \\endhead % Ph·∫ßn ƒë·∫ßu c·ªßa b·∫£ng (hi·ªÉn th·ªã tr√™n c√°c trang ti·∫øp theo)\n  \\hline\n  \\endfoot % Ph·∫ßn cu·ªëi c·ªßa b·∫£ng (hi·ªÉn th·ªã tr√™n c√°c trang tr·ª´ trang cu·ªëi)\n  \\hline\n  \\endlastfoot % Ph·∫ßn cu·ªëi c·ªßa b·∫£ng (hi·ªÉn th·ªã tr√™n trang cu·ªëi)\n  1 & Nguy·ªÖn VƒÉn A & 8.5 \\\\\n  2 & Tr·∫ßn Th·ªã B & 9.0 \\\\\n  3 & L√™ VƒÉn C & 7.5 \\\\\n  \\hline\n\\end{longtable}\n##Y√™u c·∫ßu v·ªÅ ƒë·ªãnh d·∫°ng json v√† latex b·∫Øc bu·ªôc:\n1. ƒê·ªëi v·ªõi c√¢u h·ªèi lo·∫°i 1 (nhi·ªÅu l·ª±a ch·ªçn 1 ph∆∞∆°ng √°n ƒë√∫ng) m·ªói c√¢u h·ªèi g·ªìm c√≥ c√°c key:value nh∆∞ sau:\n - \"type\": \"ex\"\n - \"id\": \"EX_<s·ªë th·ª© t·ª±>\"\n - \"title\": \"N·ªôi dung c√¢u h·ªèi lo·∫°i 1\"\n - \"choices\": [\n\t\t{ \"content\": \"N·ªôi dung ph∆∞∆°ng √°n sai 1\", \"correct\": false  },\n        { \"content\": \"N·ªôi dung ph∆∞∆°ng √°n sai 3\", \"correct\":  false },\n        { \"content\": \"N·ªôi dung ph∆∞∆°ng √°n sai 2\", \"correct\": false },\n        { \"content\": \"N·ªôi dung ph∆∞∆°ng √°n ƒë√∫ng\", \"correct\": true }]\n - \"explanation\": [\n        \"N·ªôi dung l·ªùi gi·∫£i cho ph∆∞∆°ng √°n sai 1\",\n        \"N·ªôi dung l·ªùi gi·∫£i cho ph∆∞∆°ng √°n sai 3\",\n\t\t\"N·ªôi dung l·ªùi gi·∫£i cho ph∆∞∆°ng √°n sai 2\",\n\t\t\"N·ªôi dung l·ªùi gi·∫£i cho ph∆∞∆°ng √°n ƒë√∫ng\",\n      ]\t\nCh√∫ √Ω: m·∫£ng choice c√≥ 4 object m·ªói object c√≥ hai key \"content\", \"correct\"\nv√† explanation lu√¥n c√≥ 4 ph·∫ßn t·ª≠ kh√¥ng ƒë·ªÉ tr·ªëng\n\n2. ƒê·ªëi v·ªõi c√¢u h·ªèi lo·∫°i 2 (d·∫°ng c√¢u h·ªèi 4 √Ω , m·ªói √Ω c√≥ n·ªôi dung mang t√≠nh ch·∫•t ƒë√∫ng ho·∫∑c sai) m·ªói c√¢u h·ªèi g·ªìm c√≥ c√°c key:value nh∆∞ sau:\n - \"type\": \"ex\"\n - \"id\": \"TF_<s·ªë th·ª© t·ª±>\"\n - \"title\": \"N·ªôi dung c√¢u h·ªèi lo·∫°i 2\"\n - \"choices\": [\n\t{\"content\": \"N·ªôi dung ph√°t bi·ªÉu 1\",\"correct\": true ho·∫∑c false},\n\t{\"content\": \"N·ªôi dung ph√°t bi·ªÉu 2\",\"correct\": true ho·∫∑c false},\n\t{\"content\": \"N·ªôi dung ph√°t bi·ªÉu 3\",\"correct\": true ho·∫∑c false},\n\t{\"content\": \"N·ªôi dung ph√°t bi·ªÉu 4\",\"correct\": true ho·∫∑c false}\n\t]\n - \"explanation\": [\n\t\"L·ªùi gi·∫£i chi ti·∫øt cho ph√°t bi·ªÉu 1.\",\n\t\"L·ªùi gi·∫£i chi ti·∫øt cho ph√°t bi·ªÉu 2.\",\n\t\"L·ªùi gi·∫£i chi ti·∫øt cho ph√°t bi·ªÉu 3.\",\n\t\"L·ªùi gi·∫£i chi ti·∫øt cho ph√°t bi·ªÉu 4.\"]\t\nCh√∫ √Ω: m·∫£ng choice c√≥ 4 object m·ªói object c√≥ hai key \"content\", \"correct\"\nv√† explanation lu√¥n c√≥ 4 ph·∫ßn t·ª≠ kh√¥ng ƒë·ªÉ tr·ªëng\n\n3. ƒê·ªëi v·ªõi c√¢u h·ªèi lo·∫°i 3 (d·∫°ng c√¢u h·ªèi tr·∫£ l·ªùi ng·∫Øn , k·∫øt qu·∫£ ƒë√°p √°n ·ªü d·∫°ng s·ªë li·ªáu , con s·ªë, ƒë·∫øm s·ªë l∆∞·ª£ng ,... ) m·ªói c√¢u h·ªèi g·ªìm c√≥ c√°c key:value nh∆∞ sau:\n - \"type\": \"ex\",\n - \"id\": \"SA_<s·ªë th·ª© t·ª±>\",\n - \"title\": \"N·ªôi dung c√¢u h·ªèi lo·∫°i 3\"\n - \"choices\": [{ \"content\": \"ƒê√°p √°n c√¢u h·ªèi lo·∫°i 3 d·∫°ng con s·ªë\", \"correct\": lu√¥n ƒë·ªÉ l√† true }],\n - \"explanation\": [\"N·ªôi dung lo·∫°i gi·∫£i chi ti·∫øt c√¢u h·ªèi lo·∫°i 3.\"]\t\nCh√∫ √Ω: m·∫£ng choice c√≥ 1 object  c√≥ hai key \"content\", \"correct\"\nv√† explanation lu√¥n c√≥ 1 ph·∫ßn t·ª≠ kh√¥ng ƒë·ªÉ tr·ªëng.\n\n4. ƒê·ªëi v·ªõi c√¢u h·ªèi lo·∫°i 4 (d·∫°ng b√†i t·∫≠p t·ª± lu·∫≠n) m·ªói c√¢u h·ªèi g·ªìm c√≥ c√°c key:value nh∆∞ sau:\n - \"type\": \"bt\",\n - \"id\": \"BT_<s·ªë th·ª© t·ª±>\",\n - \"title\": \"N·ªôi dung c√¢u h·ªèi lo·∫°i 4\"\n - \"choices\": [],\n - \"explanation\": [\"N·ªôi dung lo·∫°i gi·∫£i chi ti·∫øt c√¢u h·ªèi lo·∫°i 4.\"]\t\nCh√∫ √Ω: m·∫£ng choice lu√¥n ƒë·ªÉ r·ªóng v√† explanation lu√¥n c√≥ 1 ph·∫ßn t·ª≠ kh√¥ng ƒë·ªÉ tr·ªëng.\n\n\n## V√≠ d·ª• v·ªÅ ƒë·ªãnh d·∫°ng c√°c c√¢u h·ªèi\n- Lo·∫°i 1\n    {\n      \"type\": \"ex\",\n      \"id\": \"EX_1\",\n      \"title\": \"Ph√°t bi·ªÉu n√†o sau ƒë√¢y bi·ªÉu di·ªÖn ƒë√∫ng \\\"ba ph√¢n t·ª≠ kh√≠ hiƒëro\\\"?\",\n      \"choices\": [\n        { \"content\": \"$3H$\", \"correct\": false },\n        { \"content\": \"$H_3$\", \"correct\": false },\n        { \"content\": \"$H_2$\", \"correct\": false },\n        { \"content\": \"$3H_2$\", \"correct\": true }\n      ],\n      \"explanation\": [\n        \"$3H$: bi·ªÉu di·ªÖn ba nguy√™n t·ª≠ hiƒëro.\",\n        \"$H_3$: bi·ªÉu di·ªÖn m·ªôt ph√¢n t·ª≠ hiƒëro g·ªìm ba nguy√™n t·ª≠ (kh√¥ng t·ªìn t·∫°i trong ƒëi·ªÅu ki·ªán th∆∞·ªùng).\",\n        \"$H_2$: bi·ªÉu di·ªÖn m·ªôt ph√¢n t·ª≠ kh√≠ hiƒëro.\",\n        \"$3H_2$: bi·ªÉu di·ªÖn ba ph√¢n t·ª≠ kh√≠ hiƒëro. S·ªë $3$ l√† h·ªá s·ªë ch·ªâ s·ªë l∆∞·ª£ng ph√¢n t·ª≠, c√≤n s·ªë $2$ l√† ch·ªâ s·ªë d∆∞·ªõi ch·ªâ s·ªë l∆∞·ª£ng nguy√™n t·ª≠ trong m·ªôt ph√¢n t·ª≠.\"\n      ]\n    },\n- Lo·∫°i 2\n    {\n      \"type\": \"ex\",\n      \"id\": \"TF_1\",\n      \"title\": \"Ch·ªçn c√¢u ƒë√∫ng/sai v·ªÅ nguy√™n t·ªë h√≥a h·ªçc:\",\n      \"choices\": [\n        {\n          \"content\": \"Nguy√™n t·ªë h√≥a h·ªçc l√† t·∫≠p h·ª£p c√°c nguy√™n t·ª≠ c√≥ c√πng s·ªë proton trong h·∫°t nh√¢n\",\n          \"correct\": true\n        },\n        {\n          \"content\": \"Nguy√™n t·ª≠ c·ªßa c√πng m·ªôt nguy√™n t·ªë c√≥ s·ªë proton kh√°c nhau\",\n          \"correct\": false\n        },\n        {\n          \"content\": \"S·ªë hi·ªáu nguy√™n t·ª≠ c·ªßa nguy√™n t·ªë b·∫±ng s·ªë proton trong nguy√™n t·ª≠\",\n          \"correct\": true\n        },\n        {\n          \"content\": \"Nguy√™n t·ªë h√≥a h·ªçc l√† h·ª£p ch·∫•t c·∫•u t·∫°o t·ª´ nhi·ªÅu nguy√™n t·ª≠ kh√°c lo·∫°i\",\n          \"correct\": false\n        }\n      ],\n      \"explanation\": [\n        \"Nguy√™n t·ªë h√≥a h·ªçc ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a l√† t·∫≠p h·ª£p c√°c nguy√™n t·ª≠ c√≥ c√πng s·ªë proton.\",\n        \"C√°c nguy√™n t·ª≠ c·ªßa c√πng m·ªôt nguy√™n t·ªë lu√¥n c√≥ s·ªë proton gi·ªëng nhau.\",\n        \"S·ªë hi·ªáu nguy√™n t·ª≠ ch√≠nh l√† s·ªë proton trong nguy√™n t·ª≠ c·ªßa nguy√™n t·ªë ƒë√≥.\",\n        \"Nguy√™n t·ªë h√≥a h·ªçc kh√¥ng ph·∫£i l√† h·ª£p ch·∫•t, m√† l√† ch·∫•t c·∫•u t·∫°o t·ª´ m·ªôt lo·∫°i nguy√™n t·ª≠.\"\n      ]\n    },\n\n - Lo·∫°i 3\n    {\n      \"type\": \"ex\",\n      \"id\": \"SA_1\",\n      \"title\": \"Nguy√™n t·ª≠ c·ªßa nguy√™n t·ªë X c√≥ t·ªïng s·ªë proton v√† neutron trong h·∫°t nh√¢n l√† $23$, trong ƒë√≥ s·ªë proton l√† $11$. H√£y t√≠nh s·ªë neutron trong nguy√™n t·ª≠ X.\",\n      \"choices\": [\n        { \"content\": \"$12$\", \"correct\": true }\n      ],\n      \"explanation\": [\n        \"S·ªë neutron b·∫±ng t·ªïng s·ªë proton v√† neutron tr·ª´ ƒëi s·ªë proton, t·ª©c l√† $23 - 11 = 12$.\"\n      ]\n    }\n- Lo·∫°i 4\n    {\n      \"type\": \"bt\",\n      \"id\": \"BT_1\",\n      \"title\": \"Nguy√™n t·ª≠ c·ªßa nguy√™n t·ªë X c√≥ s·ªë hi·ªáu nguy√™n t·ª≠ l√† $12$, s·ªë kh·ªëi l√† $24$. H√£y ho√†n th√†nh b·∫£ng sao cho ƒë√∫ng s·ªë proton, electron v√† neutron c·ªßa nguy√™n t·ª≠ X:\\n¬† \\\\begin{tabular}{|c|c|c|c|}\\n¬† ¬† \\\\hline\\n¬† ¬† S·ªë proton & S·ªë electron & S·ªë neutron & T√™n nguy√™n t·ªë \\\\\\\\\\n¬† ¬† \\\\hline\\n¬† ¬† \\\\ & \\\\ & \\\\ & Magie ($Mg$) \\\\\\\\\\n¬† ¬† \\\\hline\\n¬† \\\\end{tabular}\",\n      \"choices\": [],\n      \"explanation\": [\n        \"V√¨ nguy√™n t·ª≠ trung h√≤a ƒëi·ªán n√™n s·ªë proton = s·ªë electron = s·ªë hi·ªáu nguy√™n t·ª≠ = $12$.\n        S·ªë neutron = s·ªë kh·ªëi - s·ªë proton = $24 - 12 = 12$.\"\n      ]\n    }\n\t\n##Ch√∫ √Ω: \n - S·ªë ph√¢n t·ª≠ trong m·∫£ng choices v√† m·∫£ng explanation trong c√¢u h·ªèi lo·∫°i 1 v√† lo·∫°i 2 ph·∫£i b·∫±ng nhau v√† b·∫±ng 4\n - S·ªë ph√¢n t·ª≠ trong m·∫£ng choices v√† m·∫£ng explanation trong c√¢u h·ªèi lo·∫°i 3  ph·∫£i b·∫±ng nhau v√† b·∫±ng 1\n - trong c√¢u h·ªèi lo·∫°i 4 S·ªë ph√¢n t·ª≠ trong m·∫£ng choices b·∫±ng 0 v√† s·ªë ph·∫ßn t·ª≠ v√† m·∫£ng explanation l√† 1\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[-912,-224],"id":"de3a916c-b48e-43c9-a901-a31a27addeea","name":"AI Agent"},{"parameters":{"sessionIdType":"customKey","sessionKey":"json_latex","tableName":"json_latex_chat_histories"},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-896,144],"id":"a509c1e5-8bd7-4d8e-886a-608e8280e22a","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"TZUniEFq0fvsFUmr","name":"Postgres Seflhost"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.outputParserAutofixing","typeVersion":1,"position":[-752,48],"id":"5dc439de-818c-4117-992c-cc8b7433a188","name":"Auto-fixing Output Parser"},{"parameters":{"schemaType":"manual","inputSchema":"={\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"title\": \"Schema C√¢u h·ªèi LaTeX (Fix L·ªói - Inline)\",\n  \"description\": \"Schema ƒë√£ ƒë∆∞·ª£c inline (kh√¥ng d√πng $ref) ƒë·ªÉ kh·∫Øc ph·ª•c l·ªói 'missing items'. ƒê·∫£m b·∫£o 4 items cho EX/TF.\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"cau_hoi_latex\": {\n      \"description\": \"M·ªôt m·∫£ng ch·ª©a danh s√°ch c√°c ƒë·ªëi t∆∞·ª£ng c√¢u h·ªèi.\",\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"object\",\n        \"description\": \"ƒê·ªãnh nghƒ©a c·∫•u tr√∫c c·ªßa m·ªôt c√¢u h·ªèi b√†i t·∫≠p.\",\n        \"properties\": {\n          \"type\": {\n            \"description\": \"Lo·∫°i ƒë·ªãnh d·∫°ng c·ªßa c√¢u h·ªèi (ex, bt)\",\n            \"type\": \"string\",\n            \"enum\": [\"ex\", \"bt\"]\n          },\n          \"id\": {\n            \"description\": \"M√£ ƒë·ªãnh danh duy nh·∫•t (v√≠ d·ª•: TF_1, EX_2, BT_3, SA_1)\",\n            \"type\": \"string\",\n            \"pattern\": \"^(EX|TF|SA|BT)_\\\\d+$\"\n          },\n          \"title\": {\n            \"description\": \"N·ªôi dung ƒë·ªÅ b√†i c·ªßa c√¢u h·ªèi (vi·∫øt b·∫±ng LaTeX)\",\n            \"type\": \"string\"\n          },\n          \"choices\": {\n            \"description\": \"M·∫£ng c√°c l·ª±a ch·ªçn.\",\n            \"type\": \"array\",\n            \"items\": {\n              \"type\": \"object\",\n              \"description\": \"ƒê·ªãnh nghƒ©a m·ªôt l·ª±a ch·ªçn tr·∫£ l·ªùi.\",\n              \"properties\": {\n                \"content\": {\n                  \"description\": \"N·ªôi dung l·ª±a ch·ªçn (vi·∫øt b·∫±ng LaTeX)\",\n                  \"type\": \"string\"\n                },\n                \"correct\": {\n                  \"description\": \"L·ª±a ch·ªçn n√†y ƒë√∫ng (true) hay sai (false)\",\n                  \"type\": \"boolean\"\n                }\n              },\n              \"required\": [\"content\", \"correct\"]\n            }\n          },\n          \"explanation\": {\n            \"description\": \"M·∫£ng ch·ª©a c√°c chu·ªói gi·∫£i th√≠ch (vi·∫øt b·∫±ng LaTeX)\",\n            \"type\": \"array\",\n            \"items\": {\n              \"type\": \"string\"\n            }\n          }\n        },\n        \"required\": [\"type\", \"id\", \"title\", \"choices\", \"explanation\"],\n        \"if\": {\n          \"description\": \"Ki·ªÉm tra ƒëi·ªÅu ki·ªán: N·∫øu ID b·∫Øt ƒë·∫ßu b·∫±ng EX ho·∫∑c TF\",\n          \"properties\": {\n            \"id\": {\n              \"pattern\": \"^(EX|TF)_\\\\d+$\"\n            }\n          }\n        },\n        \"then\": {\n          \"description\": \"Th√¨ B·∫ÆT BU·ªòC 'choices' v√† 'explanation' ph·∫£i c√≥ ƒë√∫ng 4 ph·∫ßn t·ª≠.\",\n          \"properties\": {\n            \"choices\": {\n              \"description\": \"B·∫ÆT BU·ªòC c√≥ 4 l·ª±a ch·ªçn.\",\n              \"type\": \"array\",\n              \"minItems\": 4,\n              \"maxItems\": 4,\n              \"items\": {\n                \"type\": \"object\",\n                \"description\": \"ƒê·ªãnh nghƒ©a m·ªôt l·ª±a ch·ªçn tr·∫£ l·ªùi.\",\n                \"properties\": {\n                  \"content\": {\n                    \"description\": \"N·ªôi dung l·ª±a ch·ªçn (vi·∫øt b·∫±ng LaTeX)\",\n                    \"type\": \"string\"\n                  },\n                  \"correct\": {\n                    \"description\": \"L·ª±a ch·ªçn n√†y ƒë√∫ng (true) hay sai (false)\",\n                    \"type\": \"boolean\"\n                  }\n                },\n                \"required\": [\"content\", \"correct\"]\n              }\n            },\n            \"explanation\": {\n              \"description\": \"B·∫ÆT BU·ªòC c√≥ 4 d√≤ng gi·∫£i th√≠ch.\",\n              \"type\": \"array\",\n              \"minItems\": 4,\n              \"maxItems\": 4,\n              \"items\": {\n                \"type\": \"string\"\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  \"required\": [\"cau_hoi_latex\"]\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.3,"position":[-624,224],"id":"9353e4de-5411-4b33-8777-0417b89acf06","name":"Structured Output Parser"},{"parameters":{"formTitle":"T·∫†O JSON LATEX","formDescription":"T·∫°o Json latex","formFields":{"values":[{"fieldLabel":"PROMPT","placeholder":"=T·∫°o cho t√¥i ma tr·∫≠n ƒë·ªÅ thi g·ªìm 12 c√¢u h·ªèi lo·∫°i 1, 2 c√¢u h·ªèi lo·∫°i 2, 4 c√¢u hoiar lo·∫°i 3 v√† 4 c√¢u h·ªèi lo·∫°i 4 v·ªÅ ch·ªß ƒë·ªÅ "},{"fieldLabel":"S·ªü ","placeholder":"S·ªü Gi√°o d·ª•c\\& ƒêT Gia Lai"},{"fieldLabel":"Ph√≤ng","placeholder":"Tr∆∞·ªùng THPT Chi LƒÉng"},{"fieldLabel":"Tr∆∞·ªùng","placeholder":"Tr∆∞·ªùng TH, THCS V√† THPT Sao Vi·ªát"},{"fieldLabel":"T√™n K√¨ Thi","placeholder":"KI·ªÅm tra ƒë·ªãnh k·ª≥"},{"fieldLabel":"M√¥n h·ªçc","placeholder":"H√≥a h·ªçc 9"},{"fieldLabel":"Ng√†y ki·ªÉm tra","placeholder":"31/10/2025"},{"fieldLabel":"NƒÉm h·ªçc","placeholder":"2025-2026"},{"fieldLabel":"Th·ªùi gian","placeholder":"30"},{"fieldLabel":"M√£ ƒë·ªÅ","placeholder":"301"},{"fieldLabel":"S·ªë th·ª© t·ª± ƒë·ªÅ","placeholder":"0"},{"fieldLabel":"T√™n file ƒë√°p √°n","placeholder":"HOA9_GKI_MD201"},{"fieldLabel":"S·ªë th·ª© t·ª± k√¨ thi","placeholder":"1"}]},"options":{"appendAttribution":false,"buttonLabel":"Submit","customCss":":root {\n\t--font-family: 'Open Sans', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 600;\n\t--font-size-body: 12px;\n\t--font-size-label: 14px;\n\t--font-size-test-notice: 12px;\n\t--font-size-input: 14px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 14px;\n\t--font-size-link: 12px;\n\t--font-size-error: 12px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\n\t/* Colors */\n\t--color-background: #fbfcfe;\n\t--color-test-notice-text: #e6a23d;\n\t--color-test-notice-bg: #fefaf6;\n\t--color-test-notice-border: #f6dcb7;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-link: #7e8186;\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #71747A;\n\t--color-focus-border: rgb(90, 76, 194);\n\t--color-submit-btn-bg: #ff6d5a;\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #ea1f30;\n\t--color-required: #ff6d5a;\n\t--color-clear-button-bg: #7e8186;\n\t--color-html-text: #555;\n\t--color-html-link: #ff6d5a;\n\t--color-header-subtext: #7e8186;\n\n\t/* Border Radii */\n\t--border-radius-card: 8px;\n\t--border-radius-input: 6px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 8px;\n\n\t/* Spacing */\n\t--padding-container-top: 24px;\n\t--padding-card: 24px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 24px;\n\t--margin-bottom-card: 16px;\n\t--padding-form-input: 12px;\n\t--card-padding: 24px;\n\t--card-margin-bottom: 16px;\n\n\t/* Dimensions */\n\t--container-width: 448px;\n\t--submit-btn-height: 48px;\n\t--checkbox-size: 18px;\n\n\t/* Others */\n\t--box-shadow-card: 0px 4px 16px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.5;\n}"}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.3,"position":[-1296,-224],"id":"3bede8a2-3ca8-4797-9853-928288d31b08","name":"On form submission","webhookId":"b2084767-c2b0-4ce1-b84a-ab2806be8532"},{"parameters":{"assignments":{"assignments":[{"id":"7eac0a9f-8e37-41e3-944f-095f19e44b74","name":"filepath","value":"={{ $json.file_created .replaceAll(`app`,`files`)}}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1136,-80],"id":"081f3186-0cb0-4c64-a91b-6bfe1ea80c9d","name":"input_file"},{"parameters":{"assignments":{"assignments":[{"id":"7eac0a9f-8e37-41e3-944f-095f19e44b74","name":"filename_output","value":"={{ $json.filename_output }}","type":"string"},{"id":"1c218b8e-1ad2-48f4-96cf-5dc4c5b5d72e","name":"=content_to_write","value":"={{ $json.content_to_write }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[608,-224],"id":"6df86b79-6df6-47a7-aeb5-c12c3c0a6d56","name":"file_content"},{"parameters":{"method":"POST","url":"http://python_service:5000/execute-task","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"task_name\": \"write_file\",\n  \"payload\": {\n    \"filepath\": \"./latex_document/{{ $json.filename_output }}\",\n    \"content\": {{ JSON.stringify($json.content_to_write) }}\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[912,-80],"id":"e8b7ae13-ff05-4294-acc1-59114c62b01d","name":"write_file_request"},{"parameters":{"operation":"toText","sourceProperty":"content_to_write","options":{"fileName":"={{ $json.filename_output }}"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[912,-352],"id":"b1c789aa-6408-4946-a2f7-0afba263c652","name":"Convert to File"},{"parameters":{"operation":"sendDocument","chatId":"7638885552","binaryData":true,"additionalFields":{}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[1152,-352],"id":"4e3a98a3-50f5-4866-9171-e7f864af9a37","name":"Send a document","webhookId":"8e58920a-fc15-40da-b7ce-8c6b7f728e9d","credentials":{"telegramApi":{"id":"fP6SZt8Z3ASnxJry","name":"CREATE_EXAM_MATRIX"}}},{"parameters":{"model":"google/gemini-3-pro-preview","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[-1056,-16],"id":"e21bd882-6958-49cb-9fcf-fc1ce271ce13","name":"OpenRouter Chat Model","credentials":{"openRouterApi":{"id":"u4raH9M6rBCAl4d7","name":"OpenRouter gpt 4.1 mini"}}}],"connections":{"JSON_LATEX":{"main":[[{"node":"Convert_to_latex_dao_PA_and_dao_cau_hoi_theo_ID_INDEX","type":"main","index":0}]]},"CODE_LATEX":{"main":[[{"node":"Tempt","type":"main","index":0}]]},"Tempt":{"main":[[{"node":"file_content","type":"main","index":0}]]},"Convert_code_latex_non_dao_pa":{"main":[[]]},"Convert_to_latex_dao_PA_and_dao_cau_hoi":{"main":[[]]},"Convert_to_latex_dao_PA_and_dao_cau_hoi_theo_ID":{"main":[[]]},"Convert_to_latex_dao_PA_and_dao_cau_hoi_theo_ID_INDEX":{"main":[[{"node":"JOIN","type":"main","index":0}]]},"JOIN":{"main":[[{"node":"CODE_LATEX","type":"main","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Auto-fixing Output Parser":{"ai_outputParser":[[{"node":"AI Agent","type":"ai_outputParser","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"Auto-fixing Output Parser","type":"ai_outputParser","index":0}]]},"AI Agent":{"main":[[{"node":"JSON_LATEX","type":"main","index":0}]]},"On form submission":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"input_file":{"main":[[{"node":"Read/Write Files from Disk","type":"main","index":0}]]},"file_content":{"main":[[{"node":"write_file_request","type":"main","index":0},{"node":"Convert to File","type":"main","index":0}]]},"write_file_request":{"main":[[{"node":"input_file","type":"main","index":0}]]},"Convert to File":{"main":[[{"node":"Send a document","type":"main","index":0}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0},{"node":"Auto-fixing Output Parser","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"ac383091-6fee-4cc2-8a0e-04032e7632f6","triggerCount":1,"shared":[{"updatedAt":"2025-10-26T05:25:43.765Z","createdAt":"2025-10-26T05:25:43.765Z","role":"workflow:owner","workflowId":"MS9CsgNhzyfs4Eh2","projectId":"EIQckweL3OLW7kzz"}],"tags":[]}